(()=>{"use strict";var e={5458:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(3935),t),r(i(6213),t),r(i(6057),t),r(i(119),t),r(i(3599),t),r(i(7030),t)},3599:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Activatable=void 0;const n=i(119);class r extends n.TraitAdapter{constructor(e){super("activatable"),this.activateFn=e,this.active=!1}update(e,t){this.active&&this.activateFn(e,t),this.active=!1}activate(){this.active=!0}}t.Activatable=r},3935:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ActivateOnSight=void 0;const n=i(7546),r=i(119);class a extends r.TraitAdapter{constructor(){super("activateOnSight")}update(e,t){const i=t.camera.box,r=e.bounds;i.right>r.left&&i.left<r.right?e.state=n.EntityState.ACTIVE:e.state=n.EntityState.UNTRIGGERED}}t.ActivateOnSight=a},6213:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Emitter=void 0;const n=i(7546),r=i(6057),a=i(119);class o extends a.TraitAdapter{constructor(e,t=!0,i=2,n){super("emitter"),this.entityName=e,this.repeating=t,this.interval=i,this.onEmit=n,this.cooldown=0,this.direction=1,this.cooldown=this.interval}update(e,t){this.enabled&&(this.cooldown-=t.deltaTime,this.cooldown<=0&&(this.repeating?this.cooldown=this.interval:this.enabled=!1,this.emit(e)))}emit(e){if(this.entityName){const t=n.entityRepo[this.entityName]();t.vel.x=100*this.direction,t.state=n.EntityState.ACTIVE,t.pos.set(e.pos.x,e.pos.y),e.events.publish(new r.SpawnEvent({entity:t})),this.onEmit&&this.onEmit(e)}}}t.Emitter=o},6057:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpawnEvent=t.Names=void 0,t.Names={spawn:"spawn"},t.SpawnEvent=class{constructor(e){this.payload=e,this.topic=t.Names.spawn}}},7030:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Overlappable=void 0;const n=i(8707),r=i(119);class a extends r.TraitAdapter{constructor(){super("overlappable")}update(e,t){const i=new Set(e.isOverlappingWith);t.level.entities.forEach((t=>{t!==e&&t.bounds.overlaps(e.bounds)&&(i.has(t)?(e.onOver(t),i.delete(t)):e.onEnter(t))})),i.forEach((t=>e.onLeave(t)))}overLappingWithPlayer(e){return[...e.isOverlappingWith].some((e=>e.hasTrait(n.Player)))}}t.Overlappable=a},119:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraitAdapter=void 0;const n=i(7546);t.TraitAdapter=class{constructor(e){this.name=e,this.enabled=!0,n.traitRegistry.addTrait(this)}update(e,t){}obstruct(e,t,i){}collides(e,t){}}},9511:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7179),t),r(i(7935),t),r(i(9020),t),r(i(4789),t),r(i(9527),t)},7179:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LEVEL_COLLIDER=void 0;const r=n(i(6140)),a=n(i(1366));t.LEVEL_COLLIDER=new class{checkX(e,t){t instanceof a.default&&new r.default(t).checkX(e)}checkY(e,t){t instanceof a.default&&new r.default(t).checkY(e)}check(e,t){t instanceof a.default&&new r.default(t).check(e)}}},7935:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LevelLayer=void 0;const n=i(1391),r=i(1412),a=i(7544);t.LevelLayer=class{constructor(e,t){this.tiles=e,this.tilesize=t,this.math=new r.TileMath(t)}get(e,t){return"number"==typeof e&&(e={from:e,to:e+1}),"number"==typeof t&&(t={from:t,to:t+1}),(0,n.cross)(this.math.toIndexRange(e),this.math.toIndexRange(t)).map((([e,t])=>this.getByIndex(e,t))).filter(a.notNull)}setByRange(e,t,i){(0,n.cross)(this.math.toIndexRange(e),this.math.toIndexRange(t)).forEach((([e,t])=>this.tiles.matrix.set(e,t,i)))}getByIndex(e,t){const i=this.tiles.matrix.get(e,t);return i?{tile:i,y:{from:t*this.tilesize,to:(t+1)*this.tilesize},x:{from:e*this.tilesize,to:(e+1)*this.tilesize}}:null}delete(e,t){"number"==typeof e&&(e={from:e,to:e+1}),"number"==typeof t&&(t={from:t,to:t+1}),this.setByRange(e,t,null)}get name(){return this.tiles.name}}},9020:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LEVEL_RENDERER=void 0,t.LEVEL_RENDERER=new class{constructor(){this.layers=[]}render(e,t){this.layers.forEach((i=>i.draw(e,t)))}addLayer(e){this.layers.push(e)}}},4789:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9527:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Level=void 0,t.Level=class{constructor(){this.levelTraits=[],this.levelLayer=[],this.entities=new Set}update(e){this.levelTraits.forEach((t=>t.update(this,e)))}}},2570:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(2082),t),r(i(5146),t),r(i(2641),t),r(i(5226),t),r(i(2297),t),r(i(6179),t),r(i(8693),t),r(i(136),t)},2082:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5146:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityCollider=void 0,t.EntityCollider=class{constructor(e){this.entities=e}check(e){[...this.entities].filter((t=>e!==t)).filter((t=>e.bounds.overlaps(t.bounds))).forEach((t=>e.collide(t)))}}},5226:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPlatformTileHandler=void 0;const n=i(7546);t.createPlatformTileHandler=()=>({x:()=>{},y:(e,t)=>{e.bypassPlatform||e.vel.y>0&&e.bounds.bottom>t.y.from&&e.obstruct(n.Side.BOTTOM,t)}})},2297:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSolidTileHandler=void 0;const n=i(7546);t.createSolidTileHandler=()=>({x:(e,t)=>{0!==e.vel.x&&(e.vel.x>0?e.bounds.right>t.x.from&&e.obstruct(n.Side.RIGHT,t):e.bounds.left<t.x.to&&e.obstruct(n.Side.LEFT,t))},y:(e,t)=>{0!==e.vel.y&&(e.vel.y>0?e.bounds.bottom>t.y.from&&e.obstruct(n.Side.BOTTOM,t):e.bounds.top<t.y.to&&e.obstruct(n.Side.TOP,t))}})},2641:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TileCollider=void 0;const n=i(5226),r={solid:(0,i(2297).createSolidTileHandler)(),platform:(0,n.createPlatformTileHandler)()};t.TileCollider=class{constructor(e,t){this.level=e,this.tileSize=t}static addHandler(e,t){r[e]=t}checkX(e){const t=e.bounds;if(0===e.vel.x)return;const i=e.vel.x>0?t.right:t.left;for(const n of this.level.levelLayer)n.get({from:i,to:i},{from:t.top,to:t.bottom}).forEach((t=>this.handle("x",e,t,n)))}checkY(e){const t=e.bounds;if(0===e.vel.y)return;const i=e.vel.y>0?t.bottom:t.top;for(const n of this.level.levelLayer)n.get({from:t.left,to:t.right},{from:i,to:i}).forEach((t=>this.handle("y",e,t,n)))}handle(e,t,i,n){i.tile.types&&i.tile.types.forEach((a=>{const o=r[a];o&&o[e](t,i,n)}))}}},6179:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Gravity=void 0;const n=i(1391),r=i(5458);class a extends r.TraitAdapter{constructor(e=new n.Vector(0,1500)){super("gravity"),this.gravity=e}update(e,t){const i=this.gravity.getScaledBy(t.deltaTime);e.vel.add(i)}}t.Gravity=a},136:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Physics=void 0;const n=i(9511),r=i(5458);class a extends r.TraitAdapter{constructor(){super("physics")}update(e,t){this.enabled&&(e.pos.x+=e.vel.x*t.deltaTime,n.LEVEL_COLLIDER.checkX(e,t.level),e.pos.y+=e.vel.y*t.deltaTime,n.LEVEL_COLLIDER.checkY(e,t.level))}}t.Physics=a},8693:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Solid=void 0;const n=i(7546),r=i(119);class a extends r.TraitAdapter{constructor(){super("solid")}obstruct(e,t,i){if(this.enabled)switch(t){case n.Side.BOTTOM:e.bounds.top=i.y.from-e.size.y,e.vel.y=0;break;case n.Side.RIGHT:e.bounds.left=i.x.from-e.size.x,e.vel.x=0;break;case n.Side.LEFT:e.bounds.left=i.x.to,e.vel.x=0;break;case n.Side.TOP:e.bounds.top=i.y.to,e.vel.y=0}}}t.Solid=a},7544:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.notNull=void 0,t.notNull=e=>!!e},6688:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8858),t),r(i(5386),t)},8858:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;const n=i(1391);t.Camera=class{constructor(e=new n.BoundingBox(new n.Vector(0,0),new n.Vector(n.FeatherEngine.screenSize.width,n.FeatherEngine.screenSize.height)),t=new n.Vector(n.FeatherEngine.screenSize.width,368)){this.totalMovementBounds=e,this.size=t,this.pos=new n.Vector(0,0),this.edge=new n.Vector(240,64),this.pos.set(e.left,e.top)}get box(){return new n.BoundingBox(this.pos,this.size)}get viewPort(){return this.totalMovementBounds}update(e,t){const i=e.bounds.right-this.box.right+this.edge.x,n=e.bounds.left-this.box.left-this.edge.x;this.pos.x+=Math.max(i,Math.min(n,0));const r=e.bounds.bottom-this.box.bottom+this.edge.y,a=e.bounds.top-this.box.top-this.edge.y;this.pos.y+=Math.max(r,Math.min(a,0)),this.pos.set(Math.floor(Math.max(this.totalMovementBounds.left,Math.min(this.totalMovementBounds.right-this.size.x,this.pos.x))),Math.floor(Math.max(this.totalMovementBounds.top,Math.min(this.totalMovementBounds.bottom-this.size.y,this.pos.y))))}}},5372:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391);t.default=class{constructor(e,t=128,i=128){this.entities=e,this.width=t,this.height=i,this.createBuffer(t,i)}draw(e,t){const{camera:i}=t;[...this.entities].filter((e=>e.bounds.overlaps(i.box))).forEach((t=>{this.bufferContext.clearRect(0,0,this.width,this.height),t.draw(this.bufferContext),e.drawImage(this.buffer,Math.floor(t.pos.x-i.box.left),Math.floor(t.pos.y-i.box.top))}))}createBuffer(e,t){this.bufferContext=n.CanvasRenderer.createRenderContext(e,t),this.buffer=this.bufferContext.canvas}}},5386:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SingleColorLayer=t.ParallaxLayer=t.EntityLayer=void 0;const r=n(i(5372));t.EntityLayer=r.default;const a=n(i(5842));t.ParallaxLayer=a.default;const o=n(i(5471));t.SingleColorLayer=o.default},5842:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391);t.default=class{constructor(e,t,i=8){this.img=e,this.y=t,this.scrollSpeed=i}draw(e,t){const{camera:i}=t,r=Math.floor(-i.box.left/this.scrollSpeed%this.img.width);r+this.img.width<n.FeatherEngine.screenSize.width&&e.drawImage(this.img,r+this.img.width,this.y),e.drawImage(this.img,r,this.y)}}},5471:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(3274);t.default=class{constructor(e){this.color=e}draw(e){(0,r.drawRect)(e,0,0,n.FeatherEngine.screenSize.width,n.FeatherEngine.screenSize.height,this.color,{filled:!0})}}},3183:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceRegistry=void 0;const r=i(3274),a=new class{constructor(){this.resources={}}load(e,t){return n(this,void 0,void 0,(function*(){return this.resources[e]||(this.resources[e]=t().load()),this.resources[e]}))}};t.ResourceRegistry={frame:()=>a.load("./img/frame.png",(()=>new r.NineWaySpriteSheetLoader("./img/frame.png"))),font:()=>a.load("./img/font.png",(()=>new r.FontLoader("./img/font.png")))}},6484:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7787),t),r(i(8971),t),r(i(4583),t)},7787:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShowSceneEvent=t.SHOW_SCENE_EVENT=void 0,t.SHOW_SCENE_EVENT="show_scene_event",t.ShowSceneEvent=class{constructor(e){this.payload=e,this.topic=t.SHOW_SCENE_EVENT}}},4583:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.SceneMachine=void 0;const r=i(1391),a=i(7787);class o{constructor(){this.scenes={},this.currentSceneName="loadingScene",o.instance=this}load(){return n(this,void 0,void 0,(function*(){yield this.loadingScene.load()}))}start(){r.GameLoop.register({update:e=>{this.currentScene.update(e)}},{draw:e=>{this.currentScene.draw(e)}}),r.FeatherEngine.eventBus.subscribe(a.SHOW_SCENE_EVENT,{receive:e=>this.setScene(e.payload.name,e.payload.withLoading,e.payload.forceLoading)})}setScene(e,t=!0,i=!1){return n(this,void 0,void 0,(function*(){t&&((0,r.info)(this,"Switch to Loadingscreen"),this.currentSceneName="loadingScene");const n=this.scenes[e];!i&&n.loaded||((0,r.info)(this,`Loading Scene ${e}`),yield n.scene.load(),n.loaded=!0,(0,r.info)(this,`Scene ${e} loaded`)),yield n.scene.start(),this.currentSceneName=e}))}get currentScene(){return"loadingScene"===this.currentSceneName?this.loadingScene:this.scenes[this.currentSceneName].scene}addScenes(e){return e.forEach((e=>this.addScene(e))),this}addScene(e){const t=e();return t.isLoadingScene?this.loadingScene=t:this.scenes[t.name]={scene:t,loaded:!1},this}get size(){return Object.keys(this.scenes).length+(this.loadingScene?1:0)}}t.SceneMachine=o},8971:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6115:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioBoardLoader=void 0,r(i(5315),t);const o=a(i(9620));t.AudioBoardLoader=o.default},9620:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(1391),o=r(i(5275)),s=r(i(3604));t.default=class{constructor(e){this.audioURL=e}load(){return n(this,void 0,void 0,(function*(){const e=yield(0,a.loadJson)(this.audioURL),t=new o.default,i=[...Object.keys(e.fx)];for(const n in i)if(Object.prototype.hasOwnProperty.call(i,n)){const r=i[n],a=e.fx[r].url,o=yield new s.default(t.audioContext,a).load();t.addAudio(r,o)}return t}))}}},5275:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(6500),a=i(9956),o=i(889);t.default=class{constructor(e=new AudioContext){this.audioContext=e,this.buffers={},this.enabled=!0,this.isBlocked=!1,this.onlyOneTrack=!1,this.sfxVolume=1,new r.AudioEventHandler(n.FeatherEngine.eventBus).connect(this),this.masterAudioLayer=new a.AudioLayer(this.audioContext,"Master"),this.masterAudioLayer.gainNode.connect(this.audioContext.destination),this.bgmLayer=new a.AudioLayer(this.audioContext,"BGM")}setSfxVolume(e){const t=(0,o.determineNewVolume)(e,this.sfxVolume);(0,n.log)(this,"Set SFX Volume to "+t),this.sfxVolume=t}setBgmVolume(e){this.bgmLayer.setVolume(e)}setMasterVolume(e){this.masterAudioLayer.setVolume(e)}addAudio(e,t){this.buffers[e]=t}playSfx(e,t,i=0){if(!this.enabled||this.isBlocked)return;if(Math.abs(i)>3)return;(0,n.info)(this,`Starting ${e} as Sfx`),this.lastSource&&this.onlyOneTrack&&this.lastSource.stop();const r=this.audioContext.createBufferSource(),a=this.audioContext.createGain(),o=this.createPannerNode(i);Math.abs(i)<=1&&(i=1),a.gain.value=this.sfxVolume/(i*i),r.connect(a).connect(o).connect(this.masterAudioLayer.gainNode),r.buffer=this.buffers[e],r.start(0),t&&(this.isBlocked=!0,r.onended=()=>this.isBlocked=!1),this.lastSource=r}createPannerNode(e){return new StereoPannerNode(this.audioContext,{pan:e})}playBgm(e){if(!this.enabled)return;(0,n.info)(this,`Starting ${e} as BGM`),this.bgmChannel&&this.bgmChannel.stop();const t=this.audioContext.createBufferSource();t.connect(this.bgmLayer.gainNode).connect(this.masterAudioLayer.gainNode),t.buffer=this.buffers[e],t.loop=!0,t.start(0),this.bgmChannel=t}}},6500:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AudioEventHandler=t.setMasterVolumeOn=t.setSfxVolumeOn=t.setBgmVolumeOn=t.playBgmOn=t.playSfxOn=void 0;const o=a(i(5315));t.playSfxOn=e=>({receive:t=>{const{name:i,blocking:n,position:r}=t.payload;e.playSfx(i,n,r)}}),t.playBgmOn=e=>({receive:t=>{const{name:i}=t.payload;e.playBgm(i)}}),t.setBgmVolumeOn=e=>({receive:t=>{const{value:i}=t.payload;e.setBgmVolume(i)}}),t.setSfxVolumeOn=e=>({receive:t=>{const{value:i}=t.payload;e.setSfxVolume(i)}}),t.setMasterVolumeOn=e=>({receive:t=>{const{value:i}=t.payload;e.setMasterVolume(i)}}),t.AudioEventHandler=class{constructor(e){this.eventBus=e}connect(e){this.eventBus.subscribe(o.PLAY_SFX_TOPIC,(0,t.playSfxOn)(e)),this.eventBus.subscribe(o.PLAY_BGM_TOPIC,(0,t.playBgmOn)(e)),this.eventBus.subscribe(o.SET_VOLUME_BGM,(0,t.setBgmVolumeOn)(e)),this.eventBus.subscribe(o.SET_VOLUME_SFX,(0,t.setSfxVolumeOn)(e)),this.eventBus.subscribe(o.SET_VOLUME_MASTER,(0,t.setMasterVolumeOn)(e))}}},9956:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioLayer=void 0;const n=i(1391),r=i(889);t.AudioLayer=class{constructor(e,t){this.audioContext=e,this.layerName=t,this.volume=1,this.gainNode=this.audioContext.createGain()}setVolume(e){const t=(0,r.determineNewVolume)(e,this.volume);(0,n.log)(this,"Set "+this.layerName+" Volume to "+t),this.volume=t,this.gainNode.gain.value=this.volume}}},3604:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.context=e,this.audioURL=t}load(){return i(this,void 0,void 0,(function*(){const e=yield fetch(this.audioURL),t=yield e.arrayBuffer();return this.context.decodeAudioData(t)}))}}},889:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.determineNewVolume=void 0,t.determineNewVolume=(e,t)=>{let i;return i="string"==typeof e?parseFloat(e)+t:e,Math.max(0,Math.min(1,i))}},5315:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SetSfxVolumeEvent=t.SetBgmVolumeEvent=t.SetMasterVolumeEvent=t.PlayBgmEvent=t.PlaySfxEvent=t.SET_VOLUME_SFX=t.SET_VOLUME_BGM=t.SET_VOLUME_MASTER=t.PLAY_BGM_TOPIC=t.PLAY_SFX_TOPIC=void 0,t.PLAY_SFX_TOPIC="playSFX",t.PLAY_BGM_TOPIC="playBGM",t.SET_VOLUME_MASTER="setVolumeMASTER",t.SET_VOLUME_BGM="setVolumeBGM",t.SET_VOLUME_SFX="setVolumeSFX",t.PlaySfxEvent=class{constructor(e){this.payload=e,this.topic=t.PLAY_SFX_TOPIC}},t.PlayBgmEvent=class{constructor(e){this.payload=e,this.topic=t.PLAY_BGM_TOPIC}},t.SetMasterVolumeEvent=class{constructor(e){this.payload=e,this.topic=t.SET_VOLUME_MASTER}},t.SetBgmVolumeEvent=class{constructor(e){this.payload=e,this.topic=t.SET_VOLUME_BGM}},t.SetSfxVolumeEvent=class{constructor(e){this.payload=e,this.topic=t.SET_VOLUME_SFX}}},7069:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(7546),a=i(6259);t.default=class{constructor(){this.pos=new n.Vector(0,0),this.vel=new n.Vector(0,0),this.size=new n.Vector(16,16),this.offset=new n.Vector(0,0),this.lifeTime=0,this.state=r.EntityState.ACTIVE,this.spriteChanged=!1,this.bypassPlatform=!1,this.bounds=new n.BoundingBox(this.pos,this.size,this.offset),this.traits={},this.standingOn=new Set,this.events=new a.EventStack}collide(e){this.getTraits().filter((e=>e.enabled)).forEach((t=>t.collides(this,e)))}update(e){this.getTraits().filter((e=>e.enabled)).forEach((t=>t.update(this,e))),this.lifeTime+=e.deltaTime,this.getTraits().filter((e=>e.enabled)).filter((e=>e.finalize)).forEach((e=>{e.finalize(),e.finalize=void 0})),this.standingOn.clear()}obstruct(e,t){e===r.Side.BOTTOM&&t.tile.types.forEach((e=>this.standingOn.add(e))),this.getTraits().filter((e=>e.enabled)).forEach((i=>i.obstruct(this,e,t)))}addTrait(e){this.traits[e.name]=e}addTraits(e){e.forEach((e=>this.addTrait(e)))}getTrait(e){return this.traits[(new e).name]}hasTrait(e){return null!=this.traits[(new e).name]}removeTraitByName(e){return!!this.traits[e]&&(delete this.traits[e],!0)}draw(e){e.rect(0,0,100,100)}getTraits(){return Object.keys(this.traits).map((e=>this.traits[e]))}}},6140:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(2570);t.default=class{constructor(e){this.entityCollider=new n.EntityCollider(e.entities),this.tileCollider=new n.TileCollider(e,e.tilesize)}checkX(e){this.tileCollider.checkX(e)}checkY(e){this.tileCollider.checkY(e)}check(e){this.entityCollider.check(e)}}},8881:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;class i{constructor(){this.rooms=[]}static fromValue(e){const t=new i;return t.rooms=e.map((e=>e.map((e=>n.fromValue(e))))),t}get width(){return this.rooms[0].length}get height(){return this.rooms.length}}t.default=i;class n{constructor(){this.topOpen=!1,this.leftOpen=!1,this.rightOpen=!1,this.bottomOpen=!1}get not(){return!(this.topOpen||this.leftOpen||this.rightOpen||this.bottomOpen)}static fromValue(e){const t=new n;return t.topOpen=8==(8&e),t.leftOpen=4==(4&e),t.rightOpen=2==(2&e),t.bottomOpen=1==(1&e),t}}t.Room=n},1366:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(7546),o=n(i(501)),s=i(5458),u=i(5458),l=i(9527),c=i(6115),h=n(i(4215));class d extends l.Level{constructor(e){super(),this.tilesize=e,this.entities=new Set,this.gravity=new r.Vector(0,1500),this.time=0,this.paused=!1,this.levelTraits.push(new h.default)}update(e){super.update(e),r.FeatherEngine.eventBus.subscribe(r.GAME_CONTROL_TOPIC,{receive:e=>{"pause"===e.payload&&(this.paused=!0),"resume"===e.payload&&(this.paused=!1)}});const t={deltaTime:this.paused?0:e,level:this,camera:this.camera};this.camera.update(this.findPlayer(),e),this.activateEntititesOnSight(t),this.getEntities(a.EntityState.ACTIVE).forEach((e=>e.update(t))),this.getEntities(a.EntityState.READY_TO_REMOVE).forEach((e=>this.entities.delete(e)));const i=this.getEntities(a.EntityState.ACTIVE),n=Math.max(0,i.length-150);n>0&&(i.filter((e=>e.hasTrait(s.ActivateOnSight))).slice(0,n).forEach((e=>e.state=a.EntityState.UNTRIGGERED)),console.warn("removing "+n+" active Entities")),0===this.time&&this.init(),this.time+=e,this.getEntities(a.EntityState.ACTIVE).forEach((e=>{e.events.process(u.Names.spawn,{receive:e=>{this.entities.add(e.payload.entity)}})}))}getEntities(e){return[...this.entities].filter((t=>t.state===e))}activateEntititesOnSight(e){[...this.entities].filter((e=>e.hasTrait(s.ActivateOnSight))).forEach((t=>t.getTrait(s.ActivateOnSight).update(t,e)))}findPlayer(){return[...this.entities].filter((e=>e.hasTrait(o.default))).map((e=>e.getTrait(o.default).player))[0]}init(){this.bgm&&r.FeatherEngine.eventBus.publish(new c.PlayBgmEvent({name:this.bgm}))}}t.default=d},4215:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(9511);t.default=class{update(e){e.entities.forEach((t=>n.LEVEL_COLLIDER.check(t,e)))}}},7972:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(1412);t.default=class{constructor(e){this.levelName=e}load(){return n(this,void 0,void 0,(function*(){const e=yield(0,r.loadJson)(`./levels/${this.levelName}/main.json`),t=yield new a.TiledMapLoader(e.tiledMapPath).load();return Object.assign(Object.assign({},e),{tiledMap:t})}))}}},966:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createBrickTileHandler=void 0;const n=i(7546);t.createBrickTileHandler=()=>({x:(e,t)=>{e.vel.x>0?e.bounds.right>t.x.from&&e.obstruct(n.Side.RIGHT,t):e.vel.x<0&&e.bounds.left<t.x.to&&e.obstruct(n.Side.LEFT,t)},y:(e,t,i)=>{e.vel.y>0?e.bounds.bottom>t.y.from&&e.obstruct(n.Side.BOTTOM,t):e.vel.y<0&&e.bounds.top<t.y.to&&(e.obstruct(n.Side.TOP,t),i.setByRange(t.x,t.y,void 0))}})},3067:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391);t.default=class{constructor(e,t,i=32){this.tiles=e,this.tileset=t,this.chunkSize=i,this.chunks=new n.Matrix}draw(e,t){const{camera:i}=t,n={from:this.toChunkPosition(i.box.left),to:this.toChunkPosition(i.box.right)+1},r={from:this.toChunkPosition(i.box.top),to:this.toChunkPosition(i.box.bottom)+1};for(let t=n.from;t<n.to;t++)for(let n=r.from;n<r.to;n++)this.chunks.get(t,n)||this.prepareChunk(t,n),e.drawImage(this.chunks.get(t,n),t*this.tileset.tilesize*this.chunkSize-i.box.left,n*this.tileset.tilesize*this.chunkSize-i.box.top)}prepareChunk(e,t){const i=n.CanvasRenderer.createRenderContext(this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize),r=i.canvas,a={from:e*this.chunkSize,to:(e+1)*this.chunkSize},o={from:t*this.chunkSize,to:(t+1)*this.chunkSize};this.tiles.forEach((e=>{for(let t=a.from;t<a.to;t++)for(let n=o.from;n<o.to;n++){const r=e.get(t,n);r&&this.tileset.drawTile(r.name,i,t-a.from,n-o.from)}})),this.chunks.set(e,t,r)}toChunkPosition(e){return Math.floor(e/this.tileset.tilesize/this.chunkSize)}}},4326:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391);t.default=class{constructor(e,t,i,r=32){this.tiles=e,this.tileset=t,this.time=i,this.chunkSize=r,this.buffer=n.CanvasRenderer.createRenderContext(this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize)}draw(e,t){const{camera:i}=t,n={from:this.toChunkPosition(i.box.left),to:this.toChunkPosition(i.box.right)+1},r={from:this.toChunkPosition(i.box.top),to:this.toChunkPosition(i.box.bottom)+1};for(let t=n.from;t<n.to;t++)for(let n=r.from;n<r.to;n++)e.drawImage(this.prepareChunk(t,n),t*this.tileset.tilesize*this.chunkSize-i.box.left,n*this.tileset.tilesize*this.chunkSize-i.box.top)}prepareChunk(e,t){const i=this.buffer;i.clearRect(0,0,this.chunkSize*this.tileset.tilesize,this.chunkSize*this.tileset.tilesize);const n=i.canvas,r={from:e*this.chunkSize,to:(e+1)*this.chunkSize},a={from:t*this.chunkSize,to:(t+1)*this.chunkSize};return this.tiles.forEach((e=>{for(let t=r.from;t<r.to;t++)for(let n=a.from;n<a.to;n++){const o=e.get(t,n);o&&(this.tileset.isAnimatedTile(o.name)?this.tileset.drawAnim(o.name,i,t-r.from,n-a.from,this.time()):this.tileset.drawTile(o.name,i,t-r.from,n-a.from))}})),n}toChunkPosition(e){return Math.floor(e/this.tileset.tilesize/this.chunkSize)}}},1960:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(6688);class a extends r.Camera{constructor(e){super(),this.currentCamIndex=-1,this.cameras=e.map((e=>new r.Camera(e)))}get box(){return this.currentCam.box}get currentCam(){return this.cameras[this.currentCamIndex]}update(e,t){if(this.updateCurrentCam(e),this.currentCam.update(e,t),null!=this.transition){0==this.transition.delta&&(this.transition.targetPosition=this.currentCam.box.pos);const e=this.transition.get(1.5*t);this.currentCam.box.left=e.x,this.currentCam.box.top=e.y,this.transition.delta>=1&&(this.transition=null,n.FeatherEngine.eventBus.publish(new n.ResumeGameEvent))}}updateCurrentCam(e){const t=this.cameras.map((e=>e.viewPort)).findIndex((t=>t.overlaps(e.bounds)));-1!=t?(t!=this.currentCamIndex&&-1!==this.currentCamIndex&&(this.transition=new o(this.currentCam.box.pos,this.cameras[t].box.pos),n.FeatherEngine.eventBus.publish(new n.PauseGameEvent)),this.currentCamIndex=t):n.FeatherEngine.debugSettings.enabled&&((0,n.debug)(this,"no new Camera found!"),(0,n.debug)(this,`${e.bounds}`),(0,n.debug)(this,`${this.cameras.map((e=>e.box))}`))}}t.default=a;class o{constructor(e,t){this.currentPosition=e,this.targetPosition=t,this.delta=0}get(e){return this.delta+=e,this.delta>1&&(this.delta=1),new n.Vector(this.currentPosition.x*(1-this.delta)+this.targetPosition.x*this.delta,this.currentPosition.y*(1-this.delta)+this.targetPosition.y*this.delta)}}},6928:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SaveSystem=void 0;const n=i(1391),r=i(770),a=i(8707);t.SaveSystem=class{static save(e){var t;const i=e.findPlayer(),o=i.getTrait(a.Killable);n.FeatherEngine.getSaveDataSystem().pushData({position:i.pos,life:o.hp,stage:{name:"forest"},collectables:{hasGliding:i.hasTrait(a.Glide)},savePoint:null===(t=[...e.entities].find((e=>{var t;return null===(t=e.getTrait(r.SavePoint))||void 0===t?void 0:t.active})))||void 0===t?void 0:t.pos}),n.FeatherEngine.getSaveDataSystem().storeCurrentData(0)}}},2425:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDebugToLevel=void 0;const n=i(1391),r=i(7546);t.addDebugToLevel=e=>{window&&(window.addTrait=t=>{e.findPlayer().addTraits([r.traitRegistry.byName(t)])},window.removeTrait=t=>{e.findPlayer().removeTraitByName(t)},window.testingCheatsEnabled=e=>{n.FeatherEngine.debugSettings.enabled=e},window.hitboxesOnly=e=>{n.FeatherEngine.debugSettings.hitboxesOnly=e},window.freezeEntities=()=>{e.entities.forEach((e=>e.state===r.EntityState.UNTRIGGERED))},window.FeatherEngine=n.FeatherEngine)}},5651:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(7546),o=i(5438),s=r(i(1997)),u=i(2211),l=i(1477),c=i(770),h=i(8374),d=i(1521),f=[s.default,u.DamageArea,l.BlueSlimePrefab,l.RedSlimePrefab,o.GlideCollectable,c.SavePointPrefab,h.ChestPrefab,d.ShinyPrefab];t.default=class{prepare(){return n(this,void 0,void 0,(function*(){const e=yield Promise.all(f.map((e=>new e)).map((e=>n(this,void 0,void 0,(function*(){return{name:e.name,factory:yield e.create()}})))));(0,a.setEntityRepo)(e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.factory})),{}))}))}}},8374:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChestPrefab=void 0;const r=i(1391),a=i(7546),o=n(i(7069)),s=i(5458),u=i(8707);class l extends s.TraitAdapter{constructor(){super("chestTrait"),this.prepareForCleanup=!1,this.initialized=!1}update(e){if(this.initialized)return;const t=e.getTrait(u.Killable);t&&t.hp<=0&&(t.finalize=()=>{this.spawnShiny(e),t.dead=!0},this.initialized=!0)}collides(e,t){if(this.prepareForCleanup&&(e.state=a.EntityState.READY_TO_REMOVE),t.getTrait(u.Player)){if(t.bounds.bottom>e.bounds.top&&t.bounds.top<e.bounds.top&&t.vel.y>0)return this.spawnShiny(e),this.prepareForCleanup=!0,void(t.getTrait(u.Stomp)&&t.getTrait(u.Stomp).bounce(t,e));t.bounds.right>e.bounds.left&&t.bounds.left<e.bounds.left&&(t.bounds.right=e.bounds.left),t.bounds.left<e.bounds.right&&t.bounds.right>e.bounds.right&&(t.bounds.left=e.bounds.right)}}spawnShiny(e){const t=c.getProperties(e).contentValue;for(let i=0;i<t;i++){const t=a.entityRepo.shiny();t.vel.x=100*(Math.random()-Math.random()),t.vel.y=-((0,r.random)(400)+100),t.state=a.EntityState.ACTIVE,t.pos.set(e.pos.x,e.pos.y),e.events.publish(new s.SpawnEvent({entity:t}))}}}class c extends a.EntityPrefab{constructor(){super("chest","chest"),this.entityFac=()=>new o.default,this.size=new r.Vector(16,14),this.offset=new r.Vector(0,2),this.traits=()=>[new l,new u.Killable("",1,0)]}static getProperties(e){return Object.assign({contentValue:1},e.properties)}routeFrame(){return"idle"}}t.ChestPrefab=c},5438:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlideCollectable=void 0;const a=i(1391),o=i(7546),s=r(i(7069)),u=i(5458),l=i(6115),c=r(i(5921)),h=r(i(1998));class d extends u.TraitAdapter{constructor(e){super("collectableTrait"),this.onCollect=e}update(e,t){this.lvl=t.level}collides(e,t){a.FeatherEngine.eventBus.publish(new l.PlaySfxEvent({name:"collect"})),this.onCollect(t),e.state=o.EntityState.READY_TO_REMOVE}}class f extends o.EntityPrefab{constructor(e,t,i){super(e,t),this.entityFac=()=>new s.default,this.size=new a.Vector(16,32),this.offset=new a.Vector(0,0),this.traits=()=>[new d(i)]}routeFrame(e,t){return e instanceof s.default?t.getAnimation("idle")(60*e.lifeTime):t.getAnimation("idle")(0)}create(){const e=Object.create(null,{create:{get:()=>super.create}});return n(this,void 0,void 0,(function*(){const t=a.FeatherEngine.getSaveDataSystem().getData();return this.saveDataRef(t)?()=>null:e.create.call(this)}))}}t.GlideCollectable=class extends f{constructor(){super("glide-collectable","crow_feather",(e=>{c.default.show(["You have collected a crow Feather: Glide","Press and Hold [Space] in midair to glide"]),e.addTraits([new h.default])}))}saveDataRef(e){return e.collectables.hasGliding}}},1997:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(7546),a=i(2570),o=i(5458),s=i(8707),u=i(4157);class l extends r.EntityPrefab{constructor(){super("crow","ssp:player"),this.entityFac=()=>new u.TouchableEntity,this.size=new n.Vector(20,32),this.offset=new n.Vector(32,28),this.traits=()=>[new a.Solid,new a.Gravity(new n.Vector(0,750)),new a.Physics,new s.Jump,new s.Go,new s.Stomp,new s.Killable("dead",3,0),new s.Crouch,new s.Player,new o.Overlappable]}routeFrame(e,t){const i=e.getTrait(s.Go),n=e.getTrait(s.Jump),r=e.getTrait(s.Crouch),a=(e.getTrait(s.Glide),e.getTrait(s.Killable)),o=e.getTrait(s.Attack);if(a.invulnable&&Math.floor(10*a.invulnabilityTime)%2==0)return"";if(r.active)return r.down&&!r.standUpTime?t.getAnimation("crouch")(150*r.crouchTime):t.getAnimation("standup")(150*r.standUpTime);if(n.falling){const i=e.vel.y<0?"jump_start":"jump_mid";return t.getAnimation(i)(n.timeOfCurrentPhase)}if(null==o?void 0:o.currentMove){const e=o.currentMove;return t.getAnimation(e.anim)(150*o.time)}return 0!==i.distance&&0!==e.vel.x?t.getAnimation("run")(i.distance):t.getAnimation("idle")(150*e.lifeTime)}flipped(e){return-1==e.getTrait(s.Go).facingDirection}renderOffsetForFrame(e,t){return e.startsWith("idle")||e.startsWith("run")?{x:t?0:22,y:0}:e.startsWith("slide")?{x:t?6:22,y:-12}:(e.startsWith("Attack"),{x:t?0:22,y:0})}}t.default=l},2211:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DamageArea=t.Damaging=t.TTL=void 0;const r=i(7546),a=n(i(7069)),o=i(5458),s=i(8707);class u extends o.TraitAdapter{constructor(){super("ttl"),this.time=1}update(e,t){this.time-=t.deltaTime,this.time<=0&&(e.state=r.EntityState.READY_TO_REMOVE)}}t.TTL=u;class l extends o.TraitAdapter{constructor(){super("damaging"),this.targetedEntitySet=new Set,this.damage=1}collides(e,t){var i;this.targetedEntitySet.has(t)||(this.targetedEntitySet.add(t),null===(i=t.getTrait(s.Killable))||void 0===i||i.kill(this.damage))}}t.Damaging=l;class c extends r.EntityPrefab{constructor(){super("damage-area",""),this.entityFac=()=>new a.default,this.traits=()=>[new u,new l]}routeFrame(e,t){return""}}t.DamageArea=c},1225:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(7546),o=n(i(7069));class s extends a.EntityPrefab{constructor(){super("loading","loading"),this.entityFac=()=>new o.default,this.size=new r.Vector(32,32),this.offset=new r.Vector(0,0),this.traits=()=>[]}routeFrame(e,t){return e instanceof o.default?t.getAnimation("loading")(60*e.lifeTime):t.getAnimation("loading")(0)}}t.default=s},770:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SavePoint=t.SavePointPrefab=void 0;const r=i(1391),a=i(7546),o=i(4157),s=i(6928),u=i(5458),l=n(i(5921));class c extends a.EntityPrefab{constructor(){super("save_point","save_point"),this.entityFac=()=>new o.TouchableEntity,this.size=new r.Vector(32,16),this.offset=new r.Vector(0,0),this.traits=()=>[new u.Overlappable,new u.Activatable(((e,t)=>{(0,r.info)(this,"save"),t.level.entities.forEach((e=>{e.hasTrait(h)&&(e.getTrait(h).active=!1)})),e.getTrait(h).active=!0,s.SaveSystem.save(t.level)})),new h]}flipped(){return!1}routeFrame(e,t){var i;return(null===(i=e.getTrait(h))||void 0===i?void 0:i.active)?t.getAnimation("active")(60*e.lifeTime):e.getTrait(u.Overlappable).overLappingWithPlayer(e)?t.getAnimation("highlighted")(60*e.lifeTime):t.getAnimation("idle")(60*e.lifeTime)}}t.SavePointPrefab=c;class h extends u.TraitAdapter{constructor(){super("save-point"),this.active=!1,this.hadTutorial=!1}update(e){this.hadTutorial||e.getTrait(u.Overlappable).overLappingWithPlayer(e)&&!r.FeatherEngine.getSaveDataSystem().getData().savePoint&&(l.default.show(["This is a savepoint. Press [UP] to save your process.\nWhenever you die, you will hatch on your\nlast activated savepoint."]),this.hadTutorial=!0)}}t.SavePoint=h},1521:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShinyPrefab=void 0;const r=i(1391),a=i(7546),o=n(i(7069)),s=i(5458),u=i(2570),l=i(8707);class c extends s.TraitAdapter{constructor(){super("shiny"),this.color=["red","yellow","blue"][(0,r.random)(3)]}}class h extends s.TraitAdapter{constructor(){super("bounce"),this.flyTime=1}obstruct(e){this.finalize=()=>{e.vel.y=this.g,e.vel.x/=2,this.g/=2}}update(e,t){this.g||(this.g=e.vel.y),this.flyTime-=t.deltaTime}collides(e,t){t.getTrait(l.Player)&&this.flyTime<0&&(e.state=a.EntityState.READY_TO_REMOVE)}}class d extends a.EntityPrefab{constructor(){super("shiny","shiny"),this.entityFac=()=>new o.default,this.size=new r.Vector(5,5),this.offset=new r.Vector(0,0),this.traits=()=>[new u.Solid,new u.Gravity,new h,new u.Physics,new c]}routeFrame(e){return e.getTrait(c).color}}t.ShinyPrefab=d},1477:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RedSlimePrefab=t.BlueSlimePrefab=void 0;const r=i(1391),a=i(7546),o=n(i(7069)),s=i(5458),u=i(2570),l=i(6115),c=i(8707);class h{constructor(e,t,i){this.interval=e,this.f=i,this.currentTime=0,t&&(this.currentTime=Math.random()*e)}update(e,t){this.currentTime+=e,this.currentTime>=this.interval&&(this.currentTime=0,t?t():this.f())}}class d extends s.TraitAdapter{constructor(e=new h(3,!0)){super("slime_jumping"),this.jumpingInterval=e,this.direction=-1,this.jumping=!1,this.jumpTime=new h(.1),this.onGround=!0}update(e,t){this.onGround&&this.jumpingInterval.update(t.deltaTime,(()=>{this.jumping=!0;const i=(e.bounds.left-t.camera.box.left)/r.FeatherEngine.screenSize.width;r.FeatherEngine.eventBus.publish(new l.PlaySfxEvent({name:"jump",blocking:!1,position:2*i-1}))})),this.jumping&&(e.vel.x=100*this.direction,e.vel.y=-200,this.jumpTime.update(t.deltaTime,(()=>{this.jumping=!1,this.jumpTime=new h(.2*Math.random())})))}obstruct(e,t){t===a.Side.BOTTOM&&(this.onGround=!0,this.jumping=!1,e.vel.x=0)}collides(e,t){const i=t.getTrait(c.Stomp),n=t.getTrait(c.Killable),r=e.getTrait(c.Killable);r.dead||i&&(i.fromAbove(t,e)?r&&(this.enabled=!1,r.kill()):n.kill())}}class f extends s.TraitAdapter{constructor(){super("slime_random_turn"),this.changeDir=new h(2),this.lastDelta=0}update(e,t){this.lastDelta=t.deltaTime}obstruct(e,t){t===a.Side.BOTTOM&&this.changeDir.update(this.lastDelta,(()=>{e.getTrait(d).direction=Math.sign(Math.random()-.5)}))}}class p extends s.TraitAdapter{constructor(){super("slime_random_turn"),this.changeDir=new h(2)}update(e,t){this.lastDelta=t.deltaTime,this.deltaToPlayer=t.level.findPlayer().pos.x-e.pos.x}obstruct(e,t){t===a.Side.BOTTOM&&(e.getTrait(d).direction=Math.sign(this.deltaToPlayer))}}class v extends a.EntityPrefab{constructor(e,t,i){super(e,e),this.entityFac=()=>new o.default,this.size=new r.Vector(16,16),this.offset=new r.Vector(0,-4),this.traits=()=>[new s.ActivateOnSight,new u.Gravity,new u.Solid,new u.Physics,new c.Killable("dead",1,0),i(),new t]}flipped(e){return-1==e.getTrait(d).direction}routeFrame(e,t){return t.getAnimation("idle")(60*e.lifeTime)}}t.BlueSlimePrefab=class extends v{constructor(){super("blue_slime",f,(()=>new d(new h(3,!0))))}},t.RedSlimePrefab=class extends v{constructor(){super("red_slime",p,(()=>new d(new h(3,!0))))}}},4157:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TouchableEntity=void 0;const r=n(i(7069));class a extends r.default{constructor(){super(...arguments),this.isOverlappingWith=new Set}onEnter(e){this.isOverlappingWith.add(e)}onLeave(e){this.isOverlappingWith.delete(e)}onOver(){}}t.TouchableEntity=a},3313:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Attack=void 0;const r=i(1391),a=i(7546),o=i(5458),s=i(2211),u=n(i(8701)),l=n(i(3977));class c extends o.TraitAdapter{constructor(e=1){super("attack"),this.comboSkill=e,this.enabled=!0,this.isAttacking=!1,this.moves=[{time:7,anim:"attackA",damageAreas:[{size:new r.Vector(22,32),offset:new r.Vector(42,28)}]},{time:5,anim:"attackB",damageAreas:[{size:new r.Vector(32,8),offset:new r.Vector(42,42)}]},{time:7,anim:"attackC",damageAreas:[{size:new r.Vector(32,60),offset:new r.Vector(42,0)},{size:new r.Vector(40,26),offset:new r.Vector(22,0)}]},{time:8,anim:"attackD",damageAreas:[{size:new r.Vector(32,32),offset:new r.Vector(42,28)}]}],this.nextMove=0,this.internalCurrentMove=-1,this.facing=void 0,this.queueAttack=!1,this.attackPressed=!1}update(e,t){if(this.attackPressed&&(this.attackPressed=!1,this.attackI(e)),!this.isAttacking)return;const i=e.getTrait(u.default);i&&(i.facingDirection=this.facing),e.vel.x=0,this.time+=t.deltaTime,this.time>this.currentMove.time/15&&(this.internalCurrentMove=-1,this.nextMove++,(this.nextMove>=this.moves.length||this.nextMove>=this.comboSkill)&&(this.nextMove=0,this.queueAttack=!1),this.endAttack())}endAttack(){if(this.isAttacking=!1,this.queueAttack)return this.queueAttack=!1,void this.attack();this.nextMove=0,this.facing=void 0}attack(){this.attackPressed=!0}attackI(e){e.getTrait(l.default).falling?this.attackPressed=!1:this.isAttacking?this.queueAttack=!0:(this.isAttacking=!0,this.time=0,this.internalCurrentMove=this.nextMove,this.createDamageArea(e,e.pos))}get currentMove(){return-1!==this.internalCurrentMove?this.moves[this.internalCurrentMove]:null}createDamageArea(e,t){const i=new Set;i.add(e),this.currentMove.damageAreas.forEach((n=>{var r;const l=a.entityRepo["damage-area"]();l.getTrait(s.Damaging)&&(l.getTrait(s.Damaging).targetedEntitySet=i),l.getTrait(s.TTL).time=this.currentMove.time/15,l.state=a.EntityState.ACTIVE,l.pos.set(t.x+10,t.y),this.facing=null===(r=e.getTrait(u.default))||void 0===r?void 0:r.facingDirection,l.offset.set(-1!==this.facing?n.offset.x:0,n.offset.y),l.size.set(n.size.x,n.size.y),e.events.publish(new o.SpawnEvent({entity:l}))}))}}t.Attack=c},3657:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(5458);class a extends r.TraitAdapter{constructor(){super("crouch"),this.internalDown=!1,this.lockDown=!1,this.requestEnd=!1,this.crouchTime=0,this.standUpTime=.3,this.active=!1}update(e,t){this.internalDown&&(this.crouchTime+=t.deltaTime,this.resetSize(e)),this.requestEnd&&(this.lockDown||(this.end(e),this.standUpTime+=t.deltaTime,this.standUpTime>.3&&(this.standUpTime=.3))),this.lockDown=!1}end(e){this.standUpTime<.3||(this.memoSize&&(e.size.set(this.memoSize.x,this.memoSize.y),e.pos.y-=12,this.memoSize=void 0,this.memoOffset=void 0,this.active=!1),this.internalDown=!1,this.requestEnd=!0)}start(){this.active=!0,this.internalDown=!0,this.requestEnd=!1,this.crouchTime=0,this.standUpTime=0}cancel(){this.requestEnd=!0,this.standUpTime=0}get down(){return this.internalDown}resetSize(e){this.memoSize||(this.memoSize=new n.Vector(e.size.x,e.size.y),this.memoOffset=new n.Vector(e.offset.x,e.offset.y),e.pos.y+=12,e.size.set(32,20))}}t.default=a},5623:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StompEvent=void 0,t.StompEvent=class{constructor(e){this.payload=e,this.topic="stomp"}}},1998:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(7546),r=i(5458),a=i(2570);class o extends r.TraitAdapter{constructor(){super("glide"),this.gliding=!1}start(){this.gliding=!0}cancel(){this.gliding=!1}update(e,t){const i=e.getTrait(a.Gravity);this.gliding&&i&&this.enabled&&(e.vel.y=.95*i.gravity.y*t.deltaTime)}obstruct(e,t){switch(t){case n.Side.BOTTOM:case n.Side.TOP:this.cancel()}}}t.default=o},8701:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(7546),o=i(5458),s=i(6115),u=n(i(3657)),l=n(i(3977)),c=n(i(5950));class h extends o.TraitAdapter{constructor(){super("go"),this.acceleration=400,this.deceleration=300,this.goLeft=!1,this.goRight=!1,this.distance=0,this.facingDirection=0,this.running=!1}get dragFactor(){return this.running?2e-4:5e-4}obstruct(e,t){t!==a.Side.LEFT&&t!==a.Side.RIGHT||(0!=this.distance&&r.FeatherEngine.eventBus.publish(new s.PlaySfxEvent({name:"bump"})),this.distance=0)}update(e,t){e.bounds.left<0&&(e.bounds.left=0);const i=e.getTrait(l.default),n=e.getTrait(c.default),r=e.getTrait(u.default),a=this.getDirection();if(this.turnToMovementDirection(a,i),r.down)return void this.decelToStand(e,t.deltaTime/3);if(n&&n.dead)return void e.vel.set(0,0);const o=Math.abs(e.vel.x);0!==a?e.vel.x+=this.acceleration*a*t.deltaTime:0!==e.vel.x?this.decelToStand(e,t.deltaTime):this.resetMovement(e);const s=this.dragFactor*e.vel.x*o;e.vel.x-=s,this.distance+=o*t.deltaTime}resetMovement(e){r.FeatherEngine.debugSettings.enabled&&0!==this.distance&&(0,r.debug)(this,`Standing at ${Math.round(e.pos.x/16)},${Math.round(e.pos.y/16)}`),this.distance=0}getDirection(){return this.goRight?1:this.goLeft?-1:0}turnToMovementDirection(e,t){0!==e&&t&&!t.falling&&(this.facingDirection=e)}decelToStand(e,t){const i=Math.abs(e.vel.x),n=Math.min(i,this.deceleration*t);e.vel.x+=e.vel.x>0?-n:n}right(e){this.goRight=e,e&&(this.goLeft=!1)}left(e){this.goLeft=e,e&&(this.goRight=!1)}}t.default=h},8707:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Go=t.Walk=t.Stomp=t.Player=t.PlayerController=t.LevelTimer=t.Killable=t.Jump=t.Glide=t.Crouch=void 0;const o=a(i(3657));t.Crouch=o.default;const s=a(i(1998));t.Glide=s.default;const u=a(i(8701));t.Go=u.default;const l=a(i(3977));t.Jump=l.default;const c=a(i(5950));t.Killable=c.default;const h=a(i(8412));t.LevelTimer=h.default;const d=a(i(6581));t.Player=d.default;const f=a(i(501));t.PlayerController=f.default;const p=a(i(6804));t.Stomp=p.default;const v=a(i(1736));t.Walk=v.default,r(i(3313),t)},3977:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(7546),o=i(6259),s=n(i(7069)),u=i(5458),l=i(6115),c=n(i(3657));class h{constructor(){this.topic="JumpButtonPressed",this.payload=null}}class d{constructor(){this.topic="JumpButtonReleased",this.payload=null}}class f{constructor(e){this.startVal=e,this.currentVal=e}decrease(e){this.currentVal-=e}reset(){this.currentVal=this.startVal}toZero(){this.currentVal=0}notZero(){return this.currentVal>0}get delta(){return this.startVal-this.currentVal}}class p extends u.TraitAdapter{constructor(){super("jump"),this.eventBuffer=new o.EventStack,this.velocity=220,this.raisingTime=new f(.15),this.onGround=0,this.distance=0,this.lastDir=0,this.raisingTime.toZero()}start(){this.eventBuffer.publish(new h)}cancel(){this.eventBuffer.publish(new d)}update(e,t){this.eventBuffer.process("JumpButtonReleased",{receive:()=>{this.raisingTime.toZero(),e.vel.y<0&&(e.vel.y=-this.velocity/2)}}),this.eventBuffer.process("JumpButtonPressed",{receive:()=>{const i=e.getTrait(c.default);if(null==i?void 0:i.down)return e instanceof s.default&&e.standingOn.has("platform")&&(e.bypassPlatform=!0),void this.raisingTime.toZero();if(!this.falling){e.bypassPlatform=!0,this.raisingTime.reset();const i=(e.bounds.left-t.camera.box.left)/r.FeatherEngine.screenSize.width;r.FeatherEngine.eventBus.publish(new l.PlaySfxEvent({name:"jump",blocking:!1,position:2*i-1}))}}}),this.raisingTime.notZero()&&(e.bypassPlatform=!1,e.vel.y=-this.velocity,this.raisingTime.decrease(t.deltaTime));const i=Math.sign(e.vel.y);this.lastDir!=i&&(this.distance=0),this.lastDir=i;const n=Math.abs(e.vel.y);this.distance+=n*t.deltaTime,this.onGround--}obstruct(e,t){t===a.Side.BOTTOM?(this.onGround=1,this.distance=0):t===a.Side.TOP&&(this.cancel(),this.distance=0)}get falling(){return this.onGround<0}get timeOfCurrentPhase(){return this.distance}}t.default=p},5950:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(7546),a=n(i(8701)),o=i(5458);class s extends o.TraitAdapter{constructor(e="dead",t=1,i=2){super("killable"),this.deathAnim=e,this.maxHP=t,this.fadeoutTime=i,this.dead=!1,this.deadTime=0,this.invulnabilityTime=0,this.hp=1,this.hp=t}kill(e=1){this.invulnable||this.dead||(this.hp-=e,this.invulnabilityTime=1,this.hp<=0&&(this.finalize=()=>{this.dead=!0}))}revive(e){this.dead=!1,this.hp=this.maxHP,this.invulnabilityTime=0,this.deadTime=0,e.state=r.EntityState.ACTIVE}update(e,t){this.invulnabilityTime-=t.deltaTime,this.invulnabilityTime<=0?this.invulnabilityTime=0:this.invulnabilityTime>.8&&this.repulse(e),this.dead&&(this.deadTime+=t.deltaTime,-1!=this.fadeoutTime&&this.deadTime>this.fadeoutTime&&(e.state=r.EntityState.READY_TO_REMOVE))}get invulnable(){return this.invulnabilityTime>0}repulse(e){if(e.hasTrait(a.default)){const t=e.getTrait(a.default);e.vel.x=100*-t.facingDirection,e.vel.y=-150}}}t.default=s},8412:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(5458),a=i(6115);class o extends r.TraitAdapter{constructor(e){super("leveltimer"),this.totalTime=300,this.currentTime=0,this.hurried=!1,e&&(this.totalTime=e.estimateTime)}update(e,t){this.currentTime+=t.deltaTime,this.restTime<=100&&!this.hurried&&(this.hurried=!0,n.FeatherEngine.eventBus.publish(new a.PlaySfxEvent({name:"hurry",blocking:!0})))}get restTime(){return this.totalTime-this.currentTime}}t.default=o},501:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(5458),a=n(i(5950));class o extends r.TraitAdapter{constructor(e){super("playerController"),this.level=e}setCheckpoint(e){this.checkPoint=e}setPlayer(e){this.player=e}update(){this.level.entities.has(this.player)||(this.player.getTrait(a.default).revive(this.player),this.player.pos.set(this.checkPoint.x*this.level.tilesize,this.checkPoint.y*this.level.tilesize),this.level.entities.add(this.player))}}t.default=o},6581:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(5458),r=i(4157);class a extends n.TraitAdapter{constructor(){super("player"),this.active=!1}update(e){this.active&&e instanceof r.TouchableEntity&&e.isOverlappingWith.forEach((e=>{e.hasTrait(n.Activatable)&&e.getTrait(n.Activatable).activate()})),this.active=!1}activate(){this.active=!0}}t.default=a},6804:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(5458),o=i(6115),s=i(5623),u=n(i(5950));class l extends a.TraitAdapter{constructor(){super("stomper"),this.bounceSpeed=150,this.quereBounce=!1,this.stomped=!1}fromAbove(e,t){return e.vel.y>t.vel.y}collides(e,t){const i=t.getTrait(u.default);e.getTrait(u.default).finalize||e.getTrait(u.default).dead||i&&!i.dead&&this.fromAbove(e,t)&&(this.bounce(e,t),r.FeatherEngine.eventBus.publish(new o.PlaySfxEvent({name:"stomp"})),e.events.publish(new s.StompEvent({us:e,them:t})))}bounce(e,t){this.finalize=()=>{e.bounds.bottom=t.bounds.top,e.vel.y=-this.bounceSpeed}}}t.default=l},1736:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(7546),r=i(5458);class a extends r.TraitAdapter{constructor(e=-30){super("walk"),this.speed=e,this.enabled=!0}update(e){this.enabled&&(e.vel.x=this.speed)}obstruct(e,t){t!==n.Side.LEFT&&t!==n.Side.RIGHT||(this.speed*=-1)}}t.default=a},5004:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(1391),o=i(6484),s=i(6115),u=r(i(2139)),l=r(i(935)),c=r(i(3364)),h=r(i(1722)),d=r(i(1906)),f=i(6434),p=i(2324);t.default=class{constructor(e){this.canvasId=e}start(){return n(this,void 0,void 0,(function*(){const e=(new o.SceneMachine).addScenes([()=>new l.default,()=>new c.default,()=>new d.default,()=>new h.default,()=>new u.default]);yield new s.AudioBoardLoader("./sfx/audio.json").load(),this.setVolumeBySave(),yield e.load(),e.start(),a.FeatherEngine.eventBus.publish(new o.ShowSceneEvent({name:f.SceneNames.engineScene,withLoading:!0,forceLoading:!0})),a.FeatherEngine.init({canvasId:this.canvasId,width:512,height:448}),a.FeatherEngine.start()}))}setVolumeBySave(){const e=a.FeatherEngine.getSaveDataSystem();e.clearData(),e.loadCurrentData(p.settingsSaveSlot);const t=Object.assign(Object.assign({},p.initialData),e.getData());a.FeatherEngine.eventBus.publish(new s.SetMasterVolumeEvent({value:t.masterVolume/10})),a.FeatherEngine.eventBus.publish(new s.SetBgmVolumeEvent({value:t.bgmVolume/10})),a.FeatherEngine.eventBus.publish(new s.SetSfxVolumeEvent({value:t.sfxVolume/10}))}}},3900:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(1391),o=i(7546),s=r(i(8881)),u=r(i(1366)),l=r(i(7972)),c=i(966),h=r(i(3067)),d=r(i(4326)),f=i(8309),p=i(8707),v=i(9511),y=i(2570),m=i(6688),g=r(i(7236)),b=r(i(5651)),_=r(i(1998)),w=i(6395),S=i(8873);t.default=class{constructor(e){this.saveData=e}load(){var e,t;return n(this,void 0,void 0,(function*(){const i=yield new l.default(this.saveData.stage.name).load();yield(new b.default).prepare();const r=new u.default(i.tiledMap.tileSize),O=i.minimap.map((e=>[...e].map((e=>parseInt("0x"+e)))));r.miniMap=s.default.fromValue(O),r.name=this.saveData.stage.name,r.width=i.tiledMap.width,r.height=i.tiledMap.height,i.tiledMap.entities&&i.tiledMap.entities.map((e=>Object.assign(Object.assign({},e),{entity:o.entityRepo[e.prefab]()}))).filter((({entity:e})=>e)).forEach((({position:{x:e,y:t},entity:i,properties:n})=>{i.pos.set(e,t),i.properties=n,r.entities.add(i)}));const E=o.entityRepo.crow();(null===(e=this.saveData.collectables)||void 0===e?void 0:e.hasGliding)&&E.addTrait(new _.default),E.getTrait(p.Attack)&&(E.getTrait(p.Attack).comboSkill=null!==(t=this.saveData.comboSkill)&&void 0!==t?t:1),r.startPosition=new a.Vector(i.startPosition.x,i.startPosition.y),r.estimateTime=i.estimateTime,r.bgm=i.bgm,E.state=o.EntityState.ACTIVE,r.startPosition=new a.Vector(i.startPosition.x,i.startPosition.y),r.estimateTime=i.estimateTime,r.bgm=i.bgm;const T=i.tiledMap.layers.map((e=>new v.LevelLayer(e,r.tilesize)));r.levelLayer=T;const P=[];return P.push(new m.SingleColorLayer("#6B88FE")),i.parallax&&P.push(...yield Promise.all(i.parallax.map((e=>n(this,void 0,void 0,(function*(){return new m.ParallaxLayer(yield(0,a.loadImage)(e.img),e.y,e.speed)})))))),P.push(new h.default(i.tiledMap.layers.filter((e=>!e.frontLayer&&!e.dynamic)).map((e=>e.matrix)),i.tiledMap.tileset),new d.default(i.tiledMap.layers.filter((e=>!e.frontLayer&&e.dynamic)).map((e=>e.matrix)),i.tiledMap.tileset,(()=>r.time)),new m.EntityLayer(r.entities),new h.default(i.tiledMap.layers.filter((e=>e.frontLayer&&!e.dynamic)).map((e=>e.matrix)),i.tiledMap.tileset),new d.default(i.tiledMap.layers.filter((e=>e.frontLayer&&e.dynamic)).map((e=>e.matrix)),i.tiledMap.tileset,(()=>r.time))),P.push(new g.default(r)),y.TileCollider.addHandler("brick",(0,c.createBrickTileHandler)()),y.TileCollider.addHandler("onlyCrouch",(0,S.createOnlyCrouchTileHandler)()),y.TileCollider.addHandler("deadly",(0,w.createDeadlyHandler)()),y.TileCollider.addHandler("water",(0,f.createWaterTileHandler)()),{level:r,player:E,renderer:P,viewPorts:i.tiledMap.viewPorts}}))}}},6395:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDeadlyHandler=void 0;const n=i(8707);t.createDeadlyHandler=()=>({x:e=>{const t=e.getTrait(n.Killable);null==t||t.kill()},y:e=>{const t=e.getTrait(n.Killable);null==t||t.kill()}})},8873:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOnlyCrouchTileHandler=void 0;const n=i(8707);t.createOnlyCrouchTileHandler=()=>({x:()=>{},y:e=>{const t=e.getTrait(n.Crouch);t&&(t.lockDown=!0)}})},8309:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createWaterTileHandler=void 0;const n=i(8707);t.createWaterTileHandler=function(){return{x:e=>{var t;null===(t=e.getTrait(n.Killable))||void 0===t||t.kill(1)},y:e=>{var t;null===(t=e.getTrait(n.Killable))||void 0===t||t.kill(1)}}}},5921:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(7053);t.default=class{static show(e){n.FeatherEngine.eventBus.subscribe("dialog-next",{receive:()=>{e.shift(),0==e.length?(n.FeatherEngine.eventBus.publish(new n.ResumeGameEvent),n.FeatherEngine.eventBus.publish(new n.PopControlInputEvent),n.FeatherEngine.eventBus.unsubscribeAll("dialog-next"),n.FeatherEngine.eventBus.publish({topic:"dialog-clear",payload:"x"})):n.FeatherEngine.eventBus.publish({topic:"dialog-text",payload:e[0]})}}),n.FeatherEngine.eventBus.publish(new n.StashControlInputEvent),n.FeatherEngine.eventBus.publish(new n.PauseGameEvent),n.KeyboardInput.addKeyListener({keyDown:e=>{e==r.Keys.A&&n.FeatherEngine.eventBus.publish({topic:"dialog-next",payload:"x"})},keyUp:()=>{},keyPressed:()=>{}}),n.FeatherEngine.eventBus.publish({topic:"dialog-text",payload:e[0]})}}},1043:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InitialSaveData=void 0,t.InitialSaveData={stage:{name:"forest"},collectables:{hasGliding:!1}}},2324:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.settingsSaveSlot=t.initialData=void 0,t.initialData={masterVolume:5,bgmVolume:5,sfxVolume:5},t.settingsSaveSlot=99},974:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(i(5004));n(void 0,void 0,void 0,(function*(){const e=new a.default("screen");yield e.start()}))},2139:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(6688),o=i(3183),s=i(6484),u=i(6434),l=i(6831);t.default=class{constructor(){this.name=u.SceneNames.engineScene,this.isLoadingScene=!1,this.waitTime=5,this.currentTime=0}load(){return n(this,void 0,void 0,(function*(){const e=yield o.ResourceRegistry.font();this.bg=[],this.bg.push(new a.SingleColorLayer("#555b6d")),this.bg.push(new l.EngineLayer(e,(()=>this.currentTime)))}))}start(){return n(this,void 0,void 0,(function*(){}))}update(e){this.currentTime+=e,this.currentTime>=this.waitTime&&r.FeatherEngine.eventBus.publish(new s.ShowSceneEvent({name:u.SceneNames.mainMenu,withLoading:!0,forceLoading:!0}))}draw(e){this.bg.forEach((t=>t.draw(e,{camera:new a.Camera(new r.BoundingBox(new r.Vector(0,0),new r.Vector(r.FeatherEngine.screenSize.width,r.FeatherEngine.screenSize.height)),new r.Vector(r.FeatherEngine.screenSize.width,r.FeatherEngine.screenSize.height))})))}}},6831:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EngineLayer=void 0;const n=i(1391),r=i(3274);t.EngineLayer=class{constructor(e,t){this.font=e,this.timer=t,this.hex=[...(0,n.intRange)(0,9),"a","b","c","d","e","f"],this.feather="00000000000001000000000000001410000000010011141000000011013344100000001213344410000001223333441000001122322441000000122211344100001012211333100000112212222100000001212211100000000111111000000000111100110000000100011000000000",this.order=this.shuffle((0,n.intRange)(0,this.feather.length).filter((e=>0!==e)))}draw(e){this.timer()>3&&this.font.print("Feather Engine ",e,n.FeatherEngine.screenSize.width/2-64,n.FeatherEngine.screenSize.height/2-64+128);const t=this.timer()>3?1:this.timer()/3,i=new Set(this.order.slice(0,Math.floor(t*this.order.length)));for(let t=0;t<this.feather.length;t++){const a=parseInt(this.feather.charAt(t));i.has(t)&&0!==a&&(0,r.drawRect)(e,n.FeatherEngine.screenSize.width/2-64+t%16*8,n.FeatherEngine.screenSize.height/2-64+8*Math.floor(t/16),8,8,["#000000","#878EA1","#555B6D","#333741"][a-1],{filled:!0})}if(this.timer()>4){const t=Math.min(15,Math.floor(1.5*(this.timer()-4)*16)),i=this.hex[t]+"0";(0,r.drawRect)(e,0,0,n.FeatherEngine.screenSize.width,n.FeatherEngine.screenSize.height,"#000000"+i,{filled:!0})}}shuffle(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}}},7053:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Keys=void 0,(i=t.Keys||(t.Keys={})).UP="KeyW",i.DOWN="KeyS",i.LEFT="KeyA",i.RIGHT="KeyD",i.A="Space",i.B="KeyK"},935:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(1391),o=r(i(1225)),s=i(6688),u=i(6434);t.default=class{constructor(){this.name=u.SceneNames.loadingScene,this.isLoadingScene=!0}load(){return n(this,void 0,void 0,(function*(){this.bg=[],this.bg.push(new s.SingleColorLayer("#555b6d")),this.loadingAnimation=(yield(new o.default).create())(),this.loadingAnimation.pos.set(448,392);const e=new Set;e.add(this.loadingAnimation),this.bg.push(new s.EntityLayer(e))}))}start(){return n(this,void 0,void 0,(function*(){}))}update(e){this.loadingAnimation.lifeTime+=e}draw(e){this.bg.forEach((t=>t.draw(e,{camera:new s.Camera(new a.BoundingBox(new a.Vector(0,0),new a.Vector(a.FeatherEngine.screenSize.width,a.FeatherEngine.screenSize.height)),new a.Vector(a.FeatherEngine.screenSize.width,a.FeatherEngine.screenSize.height))})))}}},2216:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(6115),a=i(7053);t.default=class{constructor(e){this.mainMenu=e}keyDown(e){switch(e){case a.Keys.A:this.mainMenu.submit();break;case a.Keys.UP:this.mainMenu.option--,n.FeatherEngine.eventBus.publish(new r.PlaySfxEvent({name:"pointer"}));break;case a.Keys.DOWN:this.mainMenu.option++,n.FeatherEngine.eventBus.publish(new r.PlaySfxEvent({name:"pointer"}));break;default:(0,n.log)(this,e)}}keyUp(){}keyPressed(){}}},3529:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1391),a=i(3274),o=n(i(4147));t.default=class{constructor(e,t,i,n){this.font=e,this.img=t,this.frame=i,this.mainMenu=n}draw(e){(0,a.drawRect)(e,0,0,r.FeatherEngine.screenSize.width,r.FeatherEngine.screenSize.height,"black",{filled:!0}),e.drawImage(this.img,0,0),this.drawSelectBox(e,(r.FeatherEngine.screenSize.width-192)/2,336);const t=r.FeatherEngine.screenSize.height-8-4;this.font.print("by DialThetti",e,r.FeatherEngine.screenSize.width-112+4,t),this.font.print("v"+o.default.version,e,4,t)}drawSelectBox(e,t,i){this.frame.draw(e,t,i,192,96);const n=i+16+4,r=t+32+4;this.mainMenu.sav.hasData(0)&&this.font.print("Continue",e,r,n),this.font.print("New Game",e,r,n+24),this.font.print("Settings",e,t+32+4,n+48),this.font.print(">",e,t+16+4,n+24*this.mainMenu.option)}}},3364:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(1391),o=i(6688),s=i(3183),u=i(6484),l=i(6115),c=i(1043),h=i(6434),d=r(i(2216)),f=r(i(3529));t.default=class{constructor(){this.name=h.SceneNames.mainMenu,this.isLoadingScene=!1,this.camera=new o.Camera,this.internalOption=0,this.max=3}load(){return n(this,void 0,void 0,(function*(){this.sav=a.FeatherEngine.getSaveDataSystem();const e=yield s.ResourceRegistry.font(),t=yield(0,a.loadImage)("./img/title.png"),i=yield s.ResourceRegistry.frame();this.layers=[new f.default(e,t,i,this)],this.sav.hasData(0)||(this.internalOption=1)}))}start(){return n(this,void 0,void 0,(function*(){a.KeyboardInput.addKeyListener(new d.default(this)),a.FeatherEngine.eventBus.publish(new l.PlayBgmEvent({name:"menu"}))}))}update(){}draw(e){this.layers.forEach((t=>t.draw(e,{camera:this.camera})))}get option(){return this.internalOption}set option(e){!this.sav.hasData(0)&&0==e||e==this.max||(this.internalOption=(e<0?e+this.max:e)%this.max)}submit(){switch(a.FeatherEngine.eventBus.publish(new l.PlaySfxEvent({name:"confirm"})),this.option){case 0:this.sav.hasData(0)&&(this.sav.loadCurrentData(0),a.FeatherEngine.eventBus.publish(new u.ShowSceneEvent({name:h.SceneNames.gameScene,withLoading:!0,forceLoading:!0})));break;case 1:this.sav.clearData(),this.sav.pushData(this.newGame()),a.FeatherEngine.eventBus.publish(new u.ShowSceneEvent({name:h.SceneNames.gameScene,withLoading:!0,forceLoading:!0}));break;case 2:a.FeatherEngine.eventBus.publish(new u.ShowSceneEvent({name:h.SceneNames.menuSettings,withLoading:!1,forceLoading:!1}))}}newGame(){return c.InitialSaveData}}},7295:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(6115),a=i(7053);t.default=class{constructor(e){this.menuSettings=e}keyDown(e){switch(e){case a.Keys.A:3===this.menuSettings.option&&this.menuSettings.submit();break;case a.Keys.UP:this.menuSettings.option--,n.FeatherEngine.eventBus.publish(new r.PlaySfxEvent({name:"pointer"}));break;case a.Keys.DOWN:this.menuSettings.option++,n.FeatherEngine.eventBus.publish(new r.PlaySfxEvent({name:"pointer"}));break;case a.Keys.RIGHT:this.menuSettings.changeSettings("inc");break;case a.Keys.LEFT:this.menuSettings.changeSettings("dec");break;default:(0,n.log)(this,e)}}keyUp(){}keyPressed(){}}},402:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(3274);t.default=class{constructor(e,t,i,n){this.font=e,this.img=t,this.frame=i,this.menuSettings=n}draw(e){(0,r.drawRect)(e,0,0,n.FeatherEngine.screenSize.width,n.FeatherEngine.screenSize.height,"black",{filled:!0}),e.drawImage(this.img,0,0),this.drawSelectBox(e,64,64)}drawSelectBox(e,t,i){this.frame.draw(e,t,i,n.FeatherEngine.screenSize.width-128,n.FeatherEngine.screenSize.height-128);const r=i+16+4,a=t+32+4;this.font.print("Master Volume",e,a,r),this.font.print(this.getVolBar(this.menuSettings.currentData.masterVolume),e,a+160,r),this.font.print("BGM Volume",e,a,r+24),this.font.print(this.getVolBar(this.menuSettings.currentData.bgmVolume),e,a+160,r+24),this.font.print("SFX Volume",e,a,r+48),this.font.print(this.getVolBar(this.menuSettings.currentData.sfxVolume),e,a+160,r+48),this.font.print("Back",e,a,r+72),this.font.print(">",e,t+16+4,r+24*this.menuSettings.option)}getVolBar(e){return"|".repeat(e)+".".repeat(10-e)}}},1722:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(1391),o=i(2324),s=i(6688),u=i(3183),l=i(6484),c=i(6115),h=i(6434),d=r(i(7295)),f=r(i(402));t.default=class{constructor(){this.name=h.SceneNames.menuSettings,this.isLoadingScene=!1,this.camera=new s.Camera,this.max=4,this.internalOption=0}load(){return n(this,void 0,void 0,(function*(){this.sav=a.FeatherEngine.getSaveDataSystem();const e=yield u.ResourceRegistry.font(),t=yield(0,a.loadImage)("./img/title.png"),i=yield yield u.ResourceRegistry.frame();this.layers=[new f.default(e,t,i,this)],this.sav.hasData(o.settingsSaveSlot)||(this.sav.clearData(),this.sav.pushData(o.initialData),this.sav.storeCurrentData(o.settingsSaveSlot)),this.sav.loadCurrentData(o.settingsSaveSlot),this.currentData=Object.assign(Object.assign({},o.initialData),this.sav.getData())}))}changeSettings(e){const t="inc"===e?1:-1;switch(this.option){case 0:this.currentData.masterVolume=Math.max(0,Math.min(10,this.currentData.masterVolume+t)),a.FeatherEngine.eventBus.publish(new c.SetMasterVolumeEvent({value:this.currentData.masterVolume/10}));break;case 1:this.currentData.bgmVolume=Math.max(0,Math.min(10,this.currentData.bgmVolume+t)),a.FeatherEngine.eventBus.publish(new c.SetBgmVolumeEvent({value:this.currentData.bgmVolume/10}));break;case 2:this.currentData.sfxVolume=Math.max(0,Math.min(10,this.currentData.sfxVolume+t)),a.FeatherEngine.eventBus.publish(new c.SetSfxVolumeEvent({value:this.currentData.sfxVolume/10}));break;default:return}this.updateSave(),a.FeatherEngine.eventBus.publish(new c.PlaySfxEvent({name:"pointer"}))}updateSave(){this.sav.clearData(),this.sav.pushData(this.currentData),this.sav.storeCurrentData(o.settingsSaveSlot)}start(){return n(this,void 0,void 0,(function*(){a.KeyboardInput.clearKeyListeners(),a.KeyboardInput.addKeyListener(new d.default(this))}))}update(){}draw(e){this.layers.forEach((t=>t.draw(e,{camera:this.camera})))}get option(){return this.internalOption}set option(e){this.internalOption=(e<0?e+this.max:e)%this.max}submit(){a.FeatherEngine.eventBus.publish(new c.PlaySfxEvent({name:"confirm"})),this.updateSave(),a.FeatherEngine.eventBus.publish(new l.ShowSceneEvent({name:h.SceneNames.mainMenu,withLoading:!1,forceLoading:!1}))}}},1906:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(1391),o=i(7546),s=r(i(7069)),u=r(i(1960)),l=i(770),c=i(8707),h=i(9511),d=i(3183),f=i(2425),p=r(i(8412)),v=r(i(3900)),y=i(6434),m=r(i(3767)),g=r(i(6274)),b=r(i(3278)),_=r(i(4365)),w=r(i(5057));t.default=class{constructor(){this.name=y.SceneNames.gameScene,this.isLoadingScene=!1}createPlayerEnv(e,t){const i=new s.default,n=new c.PlayerController(t),r=new p.default(t);return i.state=o.EntityState.ACTIVE,e.pos.set(t.startPosition.x*t.tilesize,t.startPosition.y*t.tilesize),n.setPlayer(e),n.setCheckpoint(t.startPosition),i.addTraits([n,r]),i}load(){return n(this,void 0,void 0,(function*(){const e=a.FeatherEngine.getSaveDataSystem().getData(),{level:t,player:i,renderer:n,viewPorts:r}=yield new v.default(e).load(),s=yield d.ResourceRegistry.font();a.FeatherEngine.eventBus.publish(new a.ClearControlInputEvent),a.KeyboardInput.addKeyListener(new m.default(i));const c=new u.default(r);e.position&&t.startPosition.set(e.position.x/t.tilesize,e.position.y/t.tilesize);const p=this.createPlayerEnv(i,t);i.state=o.EntityState.ACTIVE,t.entities.add(p);const y=yield d.ResourceRegistry.frame();n.push(new b.default(c),new _.default,new g.default(s,t,i),new w.default(s,y,t)),t.camera=c,this.level=t,n.forEach((e=>h.LEVEL_RENDERER.addLayer(e))),this.player=i,(0,f.addDebugToLevel)(t),e.savePoint&&this.level.entities.forEach((t=>{t.hasTrait(l.SavePoint)&&t.pos.x==e.savePoint.x&&t.pos.y==e.savePoint.y&&(t.getTrait(l.SavePoint).active=!0)}))}))}update(e){this.level.update(e)}draw(e){h.LEVEL_RENDERER.render(e,this.level)}start(){return n(this,void 0,void 0,(function*(){}))}}},3767:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(8707),a=i(6484),o=i(6115),s=i(7053),u=i(6434);t.default=class{constructor(e){this.playerFigure=e}keyDown(e){var t;const i=this.playerFigure.getTrait(r.Go),l=this.playerFigure.getTrait(r.Jump),c=this.playerFigure.getTrait(r.Crouch),h=this.playerFigure.getTrait(r.Glide),d=this.playerFigure.getTrait(r.Killable),f=this.playerFigure.getTrait(r.Attack),p=this.playerFigure.getTrait(r.Player);switch(e){case s.Keys.A:h&&l.falling?h.start():l.start();break;case s.Keys.DOWN:l.falling||c.start();break;case s.Keys.LEFT:i.left(!0);break;case s.Keys.RIGHT:i.right(!0);break;case s.Keys.UP:p.activate();break;case s.Keys.B:f&&f.attack();break;case"Digit1":n.FeatherEngine.eventBus.publish(new o.SetMasterVolumeEvent({value:"-0.1"}));break;case"Digit2":n.FeatherEngine.eventBus.publish(new o.SetMasterVolumeEvent({value:"+0.1"}));break;case"Digit5":if(!n.FeatherEngine.debugSettings.enabled)return;n.FeatherEngine.getSaveDataSystem().pushData({position:this.playerFigure.pos,life:d.hp,comboSkill:null!==(t=null==f?void 0:f.comboSkill)&&void 0!==t?t:0,stage:{name:"forest"},collectables:{hasGliding:this.playerFigure.hasTrait(r.Glide)}}),n.FeatherEngine.getSaveDataSystem().storeCurrentData(0);break;case"Digit9":if(!n.FeatherEngine.debugSettings.enabled)return;n.FeatherEngine.getSaveDataSystem().loadCurrentData(0),n.FeatherEngine.eventBus.publish(new a.ShowSceneEvent({name:u.SceneNames.gameScene,withLoading:!0,forceLoading:!0}));break;default:(0,n.log)(this,`Key ${e} was pressed without listener`)}}keyUp(e){const t=this.playerFigure.getTrait(r.Go),i=this.playerFigure.getTrait(r.Jump),n=this.playerFigure.getTrait(r.Crouch),a=this.playerFigure.getTrait(r.Glide);switch(e){case s.Keys.A:a&&a.gliding?a.cancel():i.cancel();break;case s.Keys.DOWN:n.cancel();break;case s.Keys.LEFT:t.left(!1);break;case s.Keys.RIGHT:t.right(!1)}}keyPressed(){}}},6274:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(3274),a=i(8707);t.default=class{constructor(e,t,i){this.font=e,this.level=t,this.player=i,this.rad=1}draw(e){(0,r.drawRect)(e,0,23*this.level.tilesize,n.FeatherEngine.screenSize.width,5*this.level.tilesize,"black",{filled:!0}),(0,r.drawRect)(e,0,23*this.level.tilesize,n.FeatherEngine.screenSize.width,5*this.level.tilesize,"white",{filled:!1}),this.drawLives(e),this.drawMinimap(e)}drawLives(e){this.font.print("HP",e,4,372);for(let t=0;t<this.player.getTrait(a.Killable).hp;t++)this.font.draw("o",e,16+16*t,384);for(let t=this.player.getTrait(a.Killable).hp;t<this.player.getTrait(a.Killable).maxHP;t++)this.font.draw(".",e,16+16*t,384)}drawMinimap(e){const t=Math.floor(this.level.miniMap.width*this.player.pos.x/(this.level.width*this.level.tilesize)),i=Math.floor(this.level.miniMap.height*this.player.pos.y/(this.level.height*this.level.tilesize));for(let n=t-this.rad;n<=t+this.rad;n++)for(let a=i-this.rad;a<=i+this.rad;a++){if(n<0||a<0||a>=this.level.miniMap.rooms.length||n>=this.level.miniMap.rooms[a].length)continue;const o=this.level.miniMap.rooms[a][n],s={x:16*(n-t+2)+512-80,y:16*(a-i+2)+448-80};o.not||((0,r.drawRect)(e,s.x+3,s.y+3,10,10,"grey",{filled:!0}),o.topOpen&&(0,r.drawRect)(e,s.x+6,s.y,4,3,"grey",{filled:!0}),o.bottomOpen&&(0,r.drawRect)(e,s.x+6,s.y+16-3,4,3,"grey",{filled:!0}),o.leftOpen&&(0,r.drawRect)(e,s.x,s.y+6,3,4,"grey",{filled:!0}),o.rightOpen&&(0,r.drawRect)(e,s.x+16-3,s.y+6,3,4,"grey",{filled:!0})),(0,r.drawRect)(e,470,406,4,4,"lime",{filled:!0})}}withZero(e,t){return e.toFixed().toString().padStart(t,"0")}}},3278:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(3274);t.default=class{constructor(e){this.cameraToDraw=e}draw(e){n.FeatherEngine.debugSettings.enabled&&(0,r.drawRect)(e,this.cameraToDraw.box.left,this.cameraToDraw.box.top,this.cameraToDraw.size.x,this.cameraToDraw.size.y,"purple")}}},7236:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391),r=i(3274);t.default=class{constructor(e){this.level=e,this.resolvedTiles=[],this.resolvedTiles=[],this.tileSize=e.tilesize;const t=e.levelLayer[0].getByIndex;e.levelLayer[0].getByIndex=(i,r)=>(n.FeatherEngine.debugSettings.enabled&&this.resolvedTiles.push({x:i,y:r}),t.call(e.levelLayer[0],i,r))}drawEntityFrames(e,t){this.level.entities.forEach((i=>(0,r.drawRect)(e,i.bounds.left-t.box.left,i.bounds.top-t.box.top,i.size.x,i.size.y,"red")))}drawTileFrames(e,t){this.resolvedTiles.forEach((({x:i,y:n})=>(0,r.drawRect)(e,i*this.tileSize-t.box.left,n*this.tileSize-t.box.top,this.tileSize,this.tileSize,"blue")))}draw(e,t){n.FeatherEngine.debugSettings.enabled&&(this.drawTileFrames(e,t.camera),this.drawEntityFrames(e,t.camera),this.resolvedTiles.length=0)}}},4365:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(3274),r=i(1391);t.default=class{draw(e,t){r.FeatherEngine.debugSettings.enabled&&(0,n.drawRect)(e,t.camera.edge.x,t.camera.edge.y,t.camera.size.x-2*t.camera.edge.x,t.camera.size.y-2*t.camera.edge.y,"green")}}},5057:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=i(1391);t.default=class{constructor(e,t,i){this.font=e,this.frame=t,this.level=i,n.FeatherEngine.eventBus.subscribe("dialog-text",{receive:e=>{this.textToShow=e.payload.split("\n")}}),n.FeatherEngine.eventBus.subscribe("dialog-clear",{receive:()=>{this.textToShow=null}})}draw(e){if(!this.textToShow)return;const t={x:2*this.level.tilesize,y:16*this.level.tilesize};this.frame.draw(e,t.x,t.y,n.FeatherEngine.screenSize.width-4*this.level.tilesize,5*this.level.tilesize);for(let i=0;i<this.textToShow.length;i++)this.font.print(this.textToShow[i],e,t.x+16,t.y+16+16*i)}withZero(e,t){return e.toFixed().toString().padStart(t,"0")}}},6434:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SceneNames=void 0,t.SceneNames={menuSettings:"menu-settings",mainMenu:"main-menu",loadingScene:"loading-scene",gameScene:"game-scene",engineScene:"engine-scene"}},1391:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FeatherEngine=t.KeyboardInput=void 0;var o=a(i(3169));t.FeatherEngine=o.default,r(i(6183),t);var s=i(3715);Object.defineProperty(t,"KeyboardInput",{enumerable:!0,get:function(){return s.KeyboardInput}}),r(i(2619),t),r(i(6830),t),r(i(318),t),r(i(1612),t),r(i(9939),t),r(i(3898),t),r(i(9282),t),r(i(8151),t),r(i(1691),t)},6183:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ClearControlInputEvent=t.StashControlInputEvent=t.PopControlInputEvent=t.INPUT_CONTROL_TOPIC=void 0,t.INPUT_CONTROL_TOPIC="game-control-input";t.PopControlInputEvent=function(){this.topic=t.INPUT_CONTROL_TOPIC,this.payload="pop"};t.StashControlInputEvent=function(){this.topic=t.INPUT_CONTROL_TOPIC,this.payload="stash"};t.ClearControlInputEvent=function(){this.topic=t.INPUT_CONTROL_TOPIC,this.payload="clear"}},3715:function(e,t,i){var n=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,a=t.length;r<a;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardInput=t.KeyState=void 0;var a,o=r(i(3169)),s=i(6830),u=i(9939),l=i(6183);!function(e){e[e.PRESSED=0]="PRESSED",e[e.RELEASED=1]="RELEASED"}(a=t.KeyState||(t.KeyState={}));var c=function(){function e(){var e=this;this.keyStates={},this.keyStatesChanges={},this.keyListeners=[],this.registered=!1,o.default.eventBus.subscribe(l.INPUT_CONTROL_TOPIC,{receive:function(t){"stash"===t.payload&&e.stashKeyListeners(),"pop"===t.payload&&e.popKeyListeners(),"clear"===t.payload&&e.clearKeyListeners()}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e,s.GameLoop.register(e._instance)),e._instance},enumerable:!1,configurable:!0}),e.addKeyListener=function(t){e.instance.addKeyListener(t)},e.prototype.clearKeyListeners=function(){var e=this;Object.keys(this.keyStates).forEach((function(t){e.keyStates[t]==a.PRESSED&&e.keyListeners.forEach((function(e){return e.keyUp(t)}))})),this.keyStates={},this.keyListeners.length=0,this.keyStatesChanges={}},e.clearKeyListeners=function(){e.instance.clearKeyListeners()},e.prototype.stashKeyListeners=function(){e.keyListenerStash=n([],e.instance.keyListeners,!0),this.clearKeyListeners()},e.prototype.popKeyListeners=function(){this.clearKeyListeners(),e.instance.keyListeners=e.keyListenerStash},e.prototype.handleInput=function(){var e=this;this.registered||(this.listenTo(window),this.registered=!0),Object.entries(this.keyStatesChanges).forEach((function(t){var i=t[0];t[1]==a.PRESSED?e.keyListeners.forEach((function(e){return e.keyDown(i)})):e.keyListeners.forEach((function(e){return e.keyUp(i)}))})),this.keyStatesChanges={},Object.entries(this.keyStates).filter((function(e){return e[1]===a.PRESSED})).forEach((function(t){var i=t[0];e.keyListeners.forEach((function(e){return e.keyPressed(i)}))}))},e.prototype.addKeyListener=function(e){this.keyListeners.push(e)},e.prototype.handleEvent=function(e){var t=e.code,i="keydown"===e.type?a.PRESSED:a.RELEASED;this.keyStates[t]!==i&&(this.keyStates[t]=i,this.keyStatesChanges[t]=i)},e.prototype.listenTo=function(e){var t=this;(0,u.info)(this,"Register at window"),["keydown","keyup"].forEach((function(i){e.addEventListener(i,(function(e){return t.handleEvent(e)}))}))},e.keyListenerStash=[],e}();t.KeyboardInput=c},3169:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=i(6259),r=i(6830),a=i(9939),o=i(3898),s=i(8151),u=i(8022),l=function(){function e(){this.initialized=!1,this.config=null,this.renderer=null,this.debugSettings={enabled:!1,hitboxesOnly:!1,showFPS:!1}}return e.init=function(t){e.instance.init(t)},e.start=function(){e.instance.start()},Object.defineProperty(e,"Renderer",{get:function(){return e.instance.renderer},enumerable:!1,configurable:!0}),e.getSaveDataSystem=function(){return void 0===this.saveDataSystem&&(this.saveDataSystem=new s.LocalStorageSaveDataSystem(new u.JSONSaveDataMarshaller)),this.saveDataSystem},e.setSaveDataSystem=function(e){this.saveDataSystem=e},Object.defineProperty(e,"screenSize",{get:function(){var t,i,n=null===(t=e.instance.config)||void 0===t?void 0:t.width,r=null===(i=e.instance.config)||void 0===i?void 0:i.height;return{width:null!=n?n:0,height:null!=r?r:0}},enumerable:!1,configurable:!0}),Object.defineProperty(e,"debugSettings",{get:function(){return e.instance.debugSettings},enumerable:!1,configurable:!0}),e.prototype.init=function(e){this.initialized?(0,a.warn)(this,"Engine was initialized already, new config will be ignored."):e?(this.config=e,this.renderer=new o.CanvasRenderer(e),this.initialized=!0):(0,a.warn)(this,"config is empty and will be ignored.")},e.prototype.start=function(){this.initialized?r.GameLoop.start():(0,a.error)(this,"Engine was not initialized, but tried to start. call `FeatherEngine.init(<config>)` first.")},e.instance=new e,e.eventBus=new n.EventBus,e}();t.default=l},2619:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PauseGameEvent=t.ResumeGameEvent=t.GAME_CONTROL_TOPIC=void 0,t.GAME_CONTROL_TOPIC="game-control";t.ResumeGameEvent=function(){this.topic=t.GAME_CONTROL_TOPIC,this.payload="resume"};t.PauseGameEvent=function(){this.topic=t.GAME_CONTROL_TOPIC,this.payload="pause"}},318:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6830:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GameLoop=void 0;var r=n(i(3169)),a=i(9939),o=n(i(9311)),s=function(){function e(){this.onInput=[],this.onUpdate=[],this.onDraw=[],this.timer=null}return e.register=function(){for(var t,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];(t=e.instance).register.apply(t,i)},e.start=function(){e.instance.start()},e.cancel=function(){e.instance.cancel()},e.prototype.register=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];t.forEach((function(t){var i=!1;"function"==typeof t.handleInput&&(e.onInput.push(t),i=!0),"function"==typeof t.update&&(e.onUpdate.push(t),i=!0),"function"==typeof t.draw&&(e.onDraw.push(t),i=!0),i||(0,a.info)(e,"Registration of listener failed")}))},e.prototype.start=function(){var e=this;this.timer?(0,a.warn)(this,"There is already a timer, this one needs to be canceled"):((0,a.info)(this,"Starting GameLoop"),this.timer=new o.default((function(t){return e.update(t,r.default.Renderer.context)})),this.timer.start())},e.prototype.update=function(e,t){this.onInput.forEach((function(e){return e.handleInput()})),this.onUpdate.forEach((function(t){return t.update(e)})),this.onDraw.forEach((function(e){return e.draw(t)}))},e.prototype.cancel=function(){var e;null===(e=this.timer)||void 0===e||e.cancel(),this.timer=null},e.instance=new e,e}();t.GameLoop=s},9311:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=i(9939),r=function(){function e(e,t){void 0===t&&(t=1/60),this.updateFunc=e,this.deltaTime=t,this.fps=0,this.lastTime=0,this.accumulatedTime=0,this._fps=0,this.canceled=!1}return e.prototype.update=function(e){var t=(e-this.lastTime)/1e3;for(this.accumulatedTime+=t,this.accumulatedTime>1&&(this.accumulatedTime=1,(0,n.warn)(this,"resolve sleeping"));this.accumulatedTime>this.deltaTime;)this.updateFunc(this.deltaTime),this.accumulatedTime-=this.deltaTime;this.lastTime=e,this.canceled||this.enqueue()},e.prototype.start=function(){this.enqueue(),this.updateFps()},e.prototype.cancel=function(){this.canceled=!0},e.prototype.enqueue=function(){var e=this;this._fps++,requestAnimationFrame((function(t){return e.update(t)}))},e.prototype.updateFps=function(){var e=this;setTimeout((function(){e.fps=e._fps,e._fps=0,e.updateFps()}),1e3)},e}();t.default=r},1612:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceLoader=t.loadImage=t.loadJson=void 0,t.loadJson=function(e){return i(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,fetch(e)];case 1:return 200===(t=i.sent()).status?[2,t.json()]:[3,3];case 2:return i.sent(),[3,3];case 3:return[2,{}]}}))}))},t.loadImage=function(e){return i(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return(t=new Image).src=e,[4,t.decode()];case 1:return i.sent(),[2,t]}}))}))};var r=function(){function e(){}return e.prototype.loadJson=function(e){return i(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,fetch(e)];case 1:return 200===(t=i.sent()).status?[2,t.json()]:[3,3];case 2:return i.sent(),[3,3];case 3:return[2,{}]}}))}))},e.prototype.loadImage=function(e){return i(this,void 0,void 0,(function(){var t;return n(this,(function(i){switch(i.label){case 0:return(t=new Image).src=e,[4,t.decode()];case 1:return i.sent(),[2,t]}}))}))},e}();t.ResourceLoader=r},9939:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.info=t.error=t.warn=t.debug=t.log=void 0;var i="-Engine";t.log=function(e,t){console.log("[".concat(i,":").concat(e.constructor.name,"]: ").concat(t))},t.debug=function(e,t){console.debug("[".concat(i,":").concat(e.constructor.name,"]: ").concat(t))},t.warn=function(e,t){console.warn("[".concat(i,":").concat(e.constructor.name,"]: ").concat(t))},t.error=function(e,t){console.error("[".concat(i,":").concat(e.constructor.name,"]: ").concat(t))},t.info=function(e,t){console.info("[".concat(i,":").concat(e.constructor.name,"]: ").concat(t))}},9128:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(i(9114)),a=function(){function e(e,t,i){void 0===i&&(i=new r.default(0,0)),this.pos=e,this.size=t,this.offset=i}return e.prototype.overlaps=function(e){return this.bottom>e.top&&this.top<e.bottom&&this.left<e.right&&this.right>e.left},Object.defineProperty(e.prototype,"bottom",{get:function(){return this.pos.y+this.size.y+this.offset.y},set:function(e){this.pos.y=e-(this.size.y+this.offset.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.pos.y+this.offset.y},set:function(e){this.pos.y=e-this.offset.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.pos.x+this.offset.x},set:function(e){this.pos.x=e-this.offset.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.pos.x+this.size.x+this.offset.x},set:function(e){this.pos.x=e-(this.size.x+this.offset.x)},enumerable:!1,configurable:!0}),e}();t.default=a},5517:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.random=t.intRange=t.cross=void 0,t.cross=function(e,t){return e.reduce((function(e,i){return e.concat(t.map((function(e){return[i,e]})))}),[])},t.intRange=function(e,t){return e>=t?[]:Array.from(Array(t-e).keys()).map((function(t){return t+e}))},t.random=function(e){return Math.floor(e*Math.random())}},2671:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.grid=[]}return e.prototype.set=function(e,t,i){this.grid[e]||(this.grid[e]=[]),this.grid[e][t]=i},e.prototype.get=function(e,t){return this.grid[e]?this.grid[e][t]:void 0},e.prototype.forEach=function(e){this.grid.forEach((function(t,i){t.forEach((function(t,n){e(i,n,t)}))}))},e}();t.default=i},9114:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.add=function(e){this.x+=e.x,this.y+=e.y},e.prototype.set=function(e,t){this.x=e,this.y=t},e.prototype.getScaledBy=function(t){return new e(this.x*t,this.y*t)},e}();t.default=i},3898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasRenderer=void 0;var i=function(){function e(e){var t=e.canvasId;this.canvas=document.getElementById(t);var i=this.canvas.getContext("2d");this.internalContext=i}return Object.defineProperty(e.prototype,"context",{get:function(){return this.internalContext},enumerable:!1,configurable:!0}),e.createRenderContext=function(t,i){return e.createCanvas(t,i).getContext("2d")},e.createCanvas=function(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i},e}();t.CanvasRenderer=i},8151:function(e,t){var i,n=this&&this.__extends||(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageSaveDataSystem=t.SaveDataSystem=void 0;var a=function(){function e(e){this.marshaller=e,this.currentData={}}return e.prototype.pushData=function(e){this.currentData=r(r({},this.currentData),e)},e.prototype.getData=function(){return this.currentData},e.prototype.clearData=function(){this.currentData={}},e}();t.SaveDataSystem=a;var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storage=localStorage,t}return n(t,e),t.prototype.loadCurrentData=function(e){var t=this.storage.getItem("save_"+e);this.currentData=null!==t?this.marshaller.unmarshal(t):{}},t.prototype.storeCurrentData=function(e){var t=this.marshaller.marshal(this.currentData);this.storage.setItem("save_"+e,t)},t.prototype.hasData=function(e){return!!this.storage.getItem("save_"+e)},t}(a);t.LocalStorageSaveDataSystem=o},8022:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JSONSaveDataMarshaller=void 0;var i=function(){function e(){}return e.prototype.marshal=function(e){return JSON.stringify(e)},e.prototype.unmarshal=function(e){return JSON.parse(e)},e}();t.JSONSaveDataMarshaller=i},9282:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1691:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Vector=t.Matrix=t.BoundingBox=void 0;var o=a(i(9128));t.BoundingBox=o.default;var s=a(i(2671));t.Matrix=s.default;var u=a(i(9114));t.Vector=u.default,r(i(5517),t)},7546:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(8541),t),r(i(7802),t),r(i(3037),t),r(i(6345),t),r(i(2809),t),r(i(7515),t),r(i(7451),t)},7802:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.EntityPrefab=void 0;var a=i(1391),o=i(3274),s=function(){function e(e,t){this.name=e,this.spriteName=t,this.size=new a.Vector(0,0),this.offset=new a.Vector(0,0),this.traits=function(){return[]}}return e.prototype.flipped=function(e){return e.vel.x<0},e.prototype.create=function(){return n(this,void 0,void 0,(function(){var e,t=this;return r(this,(function(i){switch(i.label){case 0:return[4,this.getSprite()];case 1:return e=i.sent(),[2,function(){var i=t.entityFac();return i.size.set(t.size.x,t.size.y),i.offset.set(t.offset.x,t.offset.y),i.addTraits(t.traits()),i.draw=function(n){if(e){var r=t.routeFrame(i,e);if(r){var a=t.flipped(i),o=t.renderOffsetForFrame(r,a);e.draw(r,n,o.x,o.y,a)}}},i}]}}))}))},e.prototype.getSprite=function(){var e;return n(this,void 0,void 0,(function(){var t,i;return r(this,(function(n){switch(n.label){case 0:return(null===(e=this.spriteName)||void 0===e?void 0:e.startsWith("ssp:"))?this.spriteName?[4,new o.SSPSpritesheetLoader("sprites","".concat(this.spriteName.replace("ssp:",""))).load()]:[3,2]:[3,4];case 1:return t=n.sent(),[3,3];case 2:t=void 0,n.label=3;case 3:return[2,t];case 4:return this.spriteName?[4,new o.SpriteSheetLoader("entities/".concat(this.spriteName)).load()]:[3,6];case 5:return i=n.sent(),[3,7];case 6:i=void 0,n.label=7;case 7:return[2,i]}}))}))},e.prototype.renderOffsetForFrame=function(e,t){return new a.Vector(0,0)},e}();t.EntityPrefab=s},3037:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setEntityRepo=t.entityRepo=void 0,t.setEntityRepo=function(e){t.entityRepo=e}},6345:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EntityState=void 0,(i=t.EntityState||(t.EntityState={}))[i.READY_TO_REMOVE=0]="READY_TO_REMOVE",i[i.ACTIVE=1]="ACTIVE",i[i.UNTRIGGERED=2]="UNTRIGGERED"},8541:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Side=void 0,(i=t.Side||(t.Side={}))[i.TOP=0]="TOP",i[i.BOTTOM=1]="BOTTOM",i[i.LEFT=2]="LEFT",i[i.RIGHT=3]="RIGHT"},7515:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},7451:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traitRegistry=t.TraitRegistry=void 0;var i=function(){function e(){this.registry={}}return e.prototype.addTrait=function(e){this.registry[e.name]=Object.getPrototypeOf(e).constructor},e.prototype.byName=function(e){return new this.registry[e]},e}();t.TraitRegistry=i,t.traitRegistry=new i},2809:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6259:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(4506),t),r(i(5726),t),r(i(2105),t),r(i(5725),t)},4506:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventBus=void 0;var r=function(){function e(){this.receivers={}}return e.prototype.publish=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return this.getTopicReceivers(e.topic).forEach((function(t){return new Promise((function(i){return i(t.receive(e))}))})),[2]}))}))},e.prototype.getTopicReceivers=function(e){var t;return null!==(t=this.receivers[e])&&void 0!==t?t:[]},e.prototype.subscribe=function(e,t){this.receivers[e]||(this.receivers[e]=[]),this.receivers[e].push(t)},e.prototype.unsubscribe=function(e,t){this.receivers[e]&&(this.receivers[e]=this.receivers[e].filter((function(e){return e!==t})))},e.prototype.unsubscribeAll=function(e){this.receivers[e]&&delete this.receivers[e]},e}();t.EventBus=r},5726:function(e,t){var i=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventStack=void 0;var r=function(){function e(){this.eventStack={}}return e.prototype.publish=function(e){return i(this,void 0,void 0,(function(){return n(this,(function(t){return this.eventStack[e.topic]||(this.eventStack[e.topic]=[]),this.eventStack[e.topic].push(e),[2]}))}))},e.prototype.process=function(e,t){this.eventStack[e]&&(this.eventStack[e].forEach((function(e){return t.receive(e)})),delete this.eventStack[e])},e}();t.EventStack=r},2105:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5725:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3274:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return r(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mergeImageContainer=t.NineWaySpriteSheet=t.TileSet=t.SpriteSheet=t.ImageContainer=t.Font=void 0,a(i(3903),t),a(i(152),t),a(i(3759),t),a(i(86),t);var u=s(i(1138));t.Font=u.default;var l=o(i(2344));t.ImageContainer=l.default,Object.defineProperty(t,"mergeImageContainer",{enumerable:!0,get:function(){return l.mergeImageContainer}});var c=s(i(6497));t.NineWaySpriteSheet=c.default;var h=s(i(9797));t.SpriteSheet=h.default;var d=s(i(7609));t.TileSet=d.default},3903:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAnim=void 0,t.createAnim=function(e,t,i){return function(n){var r,a=Math.abs(n)/t;return r=i?Math.floor(a%e.length):Math.floor(Math.min(a,e.length-1)),e[r]}}},1138:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,i,n){return e.call(this,t,i,n,!1)||this}return r(t,e),t.prototype.print=function(e,t,i,n){for(var r=0;r<e.length;r++){var a=e.charAt(r);this.draw(a,t,i+8*r,n)}},t}(a(i(9797)).default);t.default=o},152:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.drawRect=void 0,t.drawRect=function(e,t,i,n,r,a,o){if(void 0===o&&(o={filled:!1}),o.filled)return e.fillStyle=a,void e.fillRect(Math.floor(t),Math.floor(i),Math.floor(n),Math.floor(r));e.strokeStyle=a,e.beginPath(),e.rect(Math.floor(t),Math.floor(i),Math.floor(n),Math.floor(r)),e.stroke()}},2344:function(e,t,i){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)},r=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,a=t.length;r<a;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.mergeImageContainer=void 0;var a=i(1391),o=function(){function e(e,t){if(void 0===t&&(t=!1),this.img=e,this.flippable=t,this.ref=[],this.animations={},this.ref=[{img:e,pos:{}}],t){var i=a.CanvasRenderer.createRenderContext(e.width,e.height);i.scale(-1,1),i.translate(-e.width,0),i.drawImage(this.img,0,0),this.ref.push({img:i.canvas,pos:{}})}}return e.prototype.define=function(e,t,i,n,r,o){void 0===o&&(o=!1),o?(this.flippable||(0,a.error)(this,"This imagecontainer is not flippable, however, a flipped tile was tried to defined."),this.ref[1].pos[e]={x:this.ref[1].img.width-n-t,y:i,width:n,height:r}):this.ref[0].pos[e]={x:t,y:i,width:n,height:r}},e.prototype.defineAnim=function(e,t){this.animations[e]=t},e.prototype.getImage=function(e){var t=this.ref.filter((function(t){return!!t.pos[e]}))[0];if(t)return n({img:t.img},t.pos[e])},e}();t.default=o,t.mergeImageContainer=function(e,t){return e.animations=n(n({},e.animations),t.animations),e.ref=r(r([],e.ref,!0),t.ref,!0),e}},5781:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(1391),s=a(i(1138)),u=function(){function e(e){this.fontPath=e,this.chars=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~"}return e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e,t,i,n,a,o,s;return r(this,(function(r){switch(r.label){case 0:return[4,this.loadImage()];case 1:for(e=r.sent(),t=e.width,i=this.createNewFont(e,8,8),n=0;n<this.chars.length;n++)a=this.chars.charAt(n),o=8*n%t,s=8*Math.floor(8*n/t),i.define(a,o,s,8,8);return[2,i]}}))}))},e.prototype.loadImage=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,(0,o.loadImage)(this.fontPath)]}))}))},e.prototype.createNewFont=function(e,t,i){return new s.default(e,t,i)},e}();t.default=u},9284:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(1391),s=a(i(6497)),u=function(){function e(e){this.name=e}return e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,this.loadImage()];case 1:return e=t.sent(),[2,new s.default(e,!1)]}}))}))},e.prototype.loadImage=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,(0,o.loadImage)(this.name)];case 1:return[2,e.sent()]}}))}))},e}();t.default=u},3430:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(1391),s=i(3903),u=a(i(9797)),l=function(){function e(e){this.name=e}return e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e,t,i;return r(this,(function(n){switch(n.label){case 0:return[4,this.loadSheetSpec()];case 1:return e=n.sent(),[4,this.loadImage(e)];case 2:return t=n.sent(),i=this.createNewSpriteSheet(t,e.tileW,e.tileH),e.frames&&e.frames.forEach((function(e){var t=e.name,n=e.rect,r=n[0],a=n[1],o=n[2],s=n[3];i.define(t,r,a,o,s)})),e.animations&&e.animations.forEach((function(e){var t,n=(0,s.createAnim)(e.frames,e.frameLen,null===(t=null==e?void 0:e.loop)||void 0===t||t);i.defineAnim(e.name,n)})),[2,i]}}))}))},e.prototype.loadImage=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,(0,o.loadImage)(e.imageURL)];case 1:return[2,t.sent()]}}))}))},e.prototype.loadSheetSpec=function(){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,(0,o.loadJson)("./sprites/".concat(this.name,".json"))]}))}))},e.prototype.createNewSpriteSheet=function(e,t,i){return new u.default(e,t,i)},e}();t.default=l},5350:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(1391),s=i(3903),u=a(i(9797)),l=function(){function e(e,t){this.basePath=e,this.name=t,this.loader=new o.ResourceLoader}return e.prototype.load=function(){return n(this,void 0,void 0,(function(){var e,t,i;return r(this,(function(n){switch(n.label){case 0:return[4,this.loader.loadJson("".concat(this.basePath,"/").concat(this.name,".json"))];case 1:return e=n.sent(),[4,this.loader.loadImage("".concat(this.basePath,"/").concat(e.meta.image))];case 2:return t=n.sent(),i=new u.default(t,e.meta.size.w,e.meta.size.h),e.frames&&Object.keys(e.frames).map((function(t){return{name:t,data:e.frames[t].frame}})).forEach((function(e){var t=e.name,n=e.data;i.define(t,n.x,n.y,n.w,n.h)})),this.isAnimated(e)&&Object.keys(e.animations).map((function(t){return{name:t,data:e.animations[t]}})).forEach((function(e){var t,n=e.name,r=e.data,a=(0,s.createAnim)(r.frames,r.frameLen,null===(t=null==r?void 0:r.loop)||void 0===t||t);i.defineAnim(n,a)})),[2,i]}}))}))},e.prototype.isAnimated=function(e){return void 0!==e.animations},e}();t.default=l},7957:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1427:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6497:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(1391),s=i(152),u=function(e){function t(t,i){void 0===i&&(i=!1);var n=e.call(this,t,i)||this;n.img=t,n.flippable=i;var r=t.width/3,a=t.height/3;return n.define("nw",0,0,r,a),n.define("n",r,0,r,a),n.define("ne",2*r,0,r,a),n.define("w",0,a,r,a),n.define("c",r,a,r,a),n.define("e",2*r,a,r,a),n.define("sw",0,2*a,r,a),n.define("s",r,2*a,r,a),n.define("se",2*r,2*a,r,a),n.tileWidth=r,n.tileHeight=a,n}return r(t,e),t.prototype.draw=function(e,t,i,n,r){for(var a=0;a<n;a+=this.tileWidth)for(var u=0;u<r;u+=this.tileHeight){var l=this.getDir(a,u,n-this.tileWidth,r-this.tileHeight),c=this.getImage(l);c?e.drawImage(c.img,c.x,c.y,c.width,c.height,a+t,u+i,c.width,c.height):o.FeatherEngine.debugSettings.enabled?(0,s.drawRect)(e,t,i,n,r,"magenta",{filled:!0}):e.clearRect(t,i,n,r)}},t.prototype.getDir=function(e,t,i,n){return[["nw","n","ne"],["w","c","e"],["sw","s","se"]][0==t?0:t==n?2:1][0==e?0:e==i?2:1]},t}(a(i(2344)).default);t.default=u},9797:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(1391),s=i(152),u=function(e){function t(t,i,n,r){void 0===r&&(r=!0);var a=e.call(this,t,r)||this;return a.w=i,a.h=n,a}return r(t,e),t.prototype.define=function(t,i,n,r,a){e.prototype.define.call(this,t,i,n,r,a,!1),this.flippable&&e.prototype.define.call(this,t+"_switched",i,n,r,a,!0)},t.prototype.draw=function(e,t,i,n,r){void 0===r&&(r=!1);var a=this.getImage(e+(r?"_switched":""));a?t.drawImage(a.img,a.x,a.y,a.width,a.height,i,n,a.width,a.height):o.FeatherEngine.debugSettings.enabled?(0,s.drawRect)(t,i,n,this.w,this.h,"magenta",{filled:!0}):t.clearRect(i,n,this.w,this.h)},t.prototype.getAnimation=function(e){return this.animations[e]||function(){return""}},t}(a(i(2344)).default);t.default=u},7609:function(e,t,i){var n,r=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=i(1391),s=i(152),u=function(e){function t(t,i,n){var r=e.call(this,t)||this;return r.width=i,r.height=n,r.tilesize=n,r}return r(t,e),t.prototype.defineTile=function(e,t,i){this.define(e,t*this.width,i*this.height,this.width,this.height)},t.prototype.isAnimatedTile=function(e){return!!this.animations[e]},t.prototype.drawAnim=function(e,t,i,n,r){var a=this.animations[e];a&&this.drawTile(a(r),t,Math.floor(i),Math.floor(n))},t.prototype.drawTile=function(e,t,i,n){this.draw(e,t,Math.floor(this.width*i),Math.floor(this.height*n))},t.prototype.draw=function(e,t,i,n){var r=this.getImage(e);r?t.drawImage(r.img,r.x,r.y,r.width,r.height,i,n,r.width,r.height):o.FeatherEngine.debugSettings.enabled?(0,s.drawRect)(t,i,n,this.width,this.height,"magenta",{filled:!0}):t.clearRect(i,n,this.width,this.height)},t}(a(i(2344)).default);t.default=u},3759:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SSPSpritesheetLoader=t.NineWaySpriteSheetLoader=t.SpriteSheetLoader=t.FontLoader=void 0;var r=n(i(5781));t.FontLoader=r.default;var a=n(i(9284));t.NineWaySpriteSheetLoader=a.default;var o=n(i(3430));t.SpriteSheetLoader=o.default;var s=n(i(5350));t.SSPSpritesheetLoader=s.default},86:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(7957),t),r(i(1427),t)},1412:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TiledMapLoader=t.TileMath=t.Tile=void 0;var o=a(i(6019));t.TiledMapLoader=o.default;var s=a(i(3304));t.Tile=s.default;var u=a(i(6584));t.TileMath=u.default,r(i(8029),t)},8974:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=i(1391),a=i(5011),o=n(i(3304)),s=function(){function e(e){this.tileProps=e,this.booleanTags=["solid","platform","onlyCrouch","deadly","water"]}return e.prototype.create=function(e){var t=new r.Matrix;return(0,a.isInfiniteLayer)(e)&&this.handleInfiniteLayer(e,t),(0,a.isFiniteLayer)(e)&&this.handleFiniteLayer(e,t),t},e.prototype.handleFiniteLayer=function(e,t){for(var i=0;i<e.width;i++)for(var n=0;n<e.height;n++){var r=e.data[n*e.width+i];0!==r&&this.setTile(t,r,this.tileProps[r],i+e.x,n+e.y)}},e.prototype.handleInfiniteLayer=function(e,t){var i=this;e.chunks.forEach((function(e){for(var n=0;n<e.width;n++)for(var r=0;r<e.height;r++){var a=e.data[r*e.width+n];0!==a&&i.setTile(t,a,i.tileProps[a],n+e.x,r+e.y)}}))},e.prototype.setTile=function(e,t,i,n,r){var a=this,s=this.booleanTags.filter((function(e){return a.hasEnabled(i,e)}));i&&i.properties.some((function(e){return"other"===e.name&&e.value.includes("respawn")}))&&s.push("respawn"),e.set(n,r,new o.default("".concat(t),s))},e.prototype.hasEnabled=function(e,t){return e&&e.properties.some((function(e){return e.name===t&&!0===e.value}))},e}();t.default=s},6019:function(e,t,i){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},o=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,a=t.length;r<a;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(1391),l=i(3274),c=i(5235),h=s(i(8974)),d=s(i(7351)),f=function(){function e(e){var t=this;this.path=e,this.loader=function(){return(0,u.loadJson)(t.path)},this.tilesetLoader=function(e,i){return new d.default(t.directory+e.source,e.firstgid).load()},this.directory=e.substr(0,this.path.lastIndexOf("/")+1)}return e.prototype.load=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,this.loader()];case 1:return e=t.sent(),[2,this.map(e)]}}))}))},e.prototype.map=function(e){return r(this,void 0,void 0,(function(){var t,i,n,s,u,l,c,h,d=this;return a(this,(function(f){switch(f.label){case 0:return t=e.tilewidth,i=e.tileheight,t!==i&&console.warn("tiles are not squared. May cause issues"),n=this.getUsedTileIds(e),console.log("".concat(n.length," Tiles required for stage")),[4,Promise.all(o([],e.tilesets,!0).map((function(e){return r(d,void 0,void 0,(function(){return a(this,(function(t){return[2,this.tilesetLoader(e,n)]}))}))})))];case 1:return s=f.sent(),u=this.merge(s),l=this.getViewPorts(e),c=this.getEntities(e),(h={tileset:u.tileset,tileSize:t,viewPorts:l,entities:c}).layers=this.createTileMatrixes(e,u.tileMatrix),e.infinite?(h.width=e.width*e.layers[0].width,h.height=e.width*e.layers[0].height):(h.width=e.width,h.height=e.height),[2,h]}}))}))},e.prototype.getUsedTileIds=function(e){var t=e.layers.filter((function(e){return e.visible})).filter((function(e){return"tilelayer"===e.type})).map((function(e){return"chunks"in e?(0,c.distinct)((0,c.flatMap)(e.chunks.map((function(e){return(0,c.distinct)(e.data)})))):"data"in e?(0,c.distinct)(e.data):[]}));return(0,c.distinct)((0,c.flatMap)(t))},e.prototype.getViewPorts=function(e){var t=(0,c.flatMap)(e.layers.filter((function(e){return e.visible})).filter((function(e){return"objectgroup"===e.type&&"ViewPorts"==e.name})).map((function(e){return e.objects.map((function(e){return new u.BoundingBox(new u.Vector(e.x,e.y),new u.Vector(e.width,e.height))}))})));return 0==t.length?[new u.BoundingBox(new u.Vector(0,0),new u.Vector(e.width*e.tilewidth,e.height*e.tileheight))]:t},e.prototype.getEntities=function(e){var t=this;return(0,c.flatMap)(e.layers.filter((function(e){return e.visible})).filter((function(e){return"objectgroup"===e.type&&"Entities"==e.name})).map((function(e){return e.objects.map((function(e){return n(n({},e),{prefabId:t.getProperty(e.properties,"entity_prefab")})})).filter((function(e){return void 0!==e.prefabId})).map((function(e){return{prefab:e.prefabId,position:{x:e.x,y:e.y},properties:t.toMap(e.properties)}}))})))},e.prototype.toMap=function(e){var t={};return e.forEach((function(e){return t[e.name]=e.value})),t},e.prototype.getProperty=function(e,t){return e.filter((function(e){return e.name==t})).map((function(e){return e.value})).pop()},e.prototype.createTileMatrixes=function(e,t){var i=this,n=new h.default(t);return e.layers.filter((function(e){return e.visible})).filter((function(e){return"tilelayer"===e.type})).map((function(e){return{name:e.name,matrix:n.create(e),frontLayer:i.hasEnabled(e,"frontLayer"),dynamic:i.hasEnabled(e,"dynamic")}}))},e.prototype.hasEnabled=function(e,t){return e&&e.properties.some((function(e){return e.name===t&&!0===e.value}))},e.prototype.merge=function(e){return e.reduce((function(e,t){return{tileMatrix:n(n({},e.tileMatrix),t.tileMatrix),tileset:(0,l.mergeImageContainer)(e.tileset,t.tileset)}}))},e}();t.default=f},7351:function(e,t,i){var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(r,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,s)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var i,n,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{i=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=i(1391),o=i(3274),s=function(){function e(e,t){var i=this;this.path=e,this.idOffset=t,this.loader=function(){return(0,a.loadJson)(i.path)},this.imageLoader=function(e){return(0,a.loadImage)(e)},this.createTileSet=function(e,t){return new o.TileSet(e,t.tilewidth,t.tileheight)},this.directory=e.substr(0,this.path.lastIndexOf("/")+1)}return e.prototype.filteredBy=function(e){return this.onlyRequiredIds=e,this},e.prototype.load=function(){var e,t;return n(this,void 0,void 0,(function(){var i,n,a,s,u,l,c,h,d,f=this;return r(this,(function(r){switch(r.label){case 0:return[4,this.loader()];case 1:return i=r.sent(),[4,this.imageLoader(this.directory+i.image)];case 2:for(n=r.sent(),a=this.createTileSet(n,i),s={},u=0;u<i.tilecount;u++)l=u+this.idOffset,this.onlyRequiredIds&&!this.onlyRequiredIds.includes(l)||(c=u%i.columns,h=Math.floor(u/i.columns),a.defineTile("".concat(l),c,h),i.tiles&&(s[u+this.idOffset]=i.tiles[u],0!=(d=null!==(t=null===(e=i.tiles[u])||void 0===e?void 0:e.animation)&&void 0!==t?t:[]).length&&(console.debug("add 1 animation "+l),a.defineAnim("".concat(l),(0,o.createAnim)(d.map((function(e){return""+(e.tileid+f.idOffset)})),d[0].duration/1e3,!0)))));return[2,{tileset:a,tileMatrix:s}]}}))}))},e}();t.default=s},8029:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var r=Object.getOwnPropertyDescriptor(t,i);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,r)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||n(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),r(i(6624),t),r(i(5614),t)},6624:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5614:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5011:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFiniteLayer=t.isInfiniteLayer=void 0,t.isInfiniteLayer=function(e){return"chunks"in e},t.isFiniteLayer=function(e){return"data"in e}},5235:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.distinct=t.flatMap=void 0,t.flatMap=function(e){return e.reduce((function(e,t){return e.concat(t)}),[])},t.distinct=function(e){return e.filter((function(e,t,i){return i.indexOf(e)===t}))}},3304:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){this.name=e,this.types=t}},6584:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.tilesize=e}return e.prototype.toIndex=function(e){return Math.floor(e/this.tilesize)},e.prototype.toIndexRange=function(e){var t=Math.ceil(e.to/this.tilesize)*this.tilesize,i=[],n=e.from;do{i.push(this.toIndex(n)),n+=this.tilesize}while(n<t);return i},e}();t.default=i},4147:e=>{e.exports=JSON.parse('{"name":"xblrrer","version":"0.0.20220422-3","description":"","private":true,"scripts":{"prod":"serve ./dist","start":"webpack serve --config webpack.config.dev.js","build":"webpack --config webpack.config.js ","test":"jest --coverage","test:watch":"jest --watch","format":"prettier --write \'src/**/*.ts\'","dependencyInsight:svg":"node_modules/.bin/depcruise --ts-config tsconfig.json --exclude \'^node_modules\' --output-type dot src/app/main.ts > dependencies.dot && dot dependencies.dot -T svg -o dependencies.svg","dependencyInsight:json":"node_modules/.bin/depcruise --ts-config tsconfig.json --exclude \'^node_modules\' --output-type json src/app/main.ts > dependencies.json","lint":"eslint --fix \'src/**/*.ts\'"},"nyc":{"extension":[".ts"],"exclude":["**/*.d.ts","**/*.spec.ts"],"include":["src/**"],"reporter":["html","clover","lcovonly"],"all":true},"author":"","license":"ISC","dependencies":{"@dialthetti/feather-engine-core":"0.1.2","@dialthetti/feather-engine-entities":"0.1.4","@dialthetti/feather-engine-events":"0.1.1","@dialthetti/feather-engine-graphics":"0.1.1","@dialthetti/feather-engine-tiled":"0.3.1"}}')}},t={};!function i(n){var r=t[n];if(void 0!==r)return r.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}(974)})();